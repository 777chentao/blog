<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>面试问题-JS | CT&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/logo.png">
    <meta name="description" content="study, research, record, work">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/blog/assets/css/0.styles.1d7c383d.css" as="style"><link rel="preload" href="/blog/assets/js/app.b9a39c6d.js" as="script"><link rel="preload" href="/blog/assets/js/3.9920081a.js" as="script"><link rel="preload" href="/blog/assets/js/1.a52b134f.js" as="script"><link rel="preload" href="/blog/assets/js/45.d326a0e3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.74e3c656.js"><link rel="prefetch" href="/blog/assets/js/11.125b23c7.js"><link rel="prefetch" href="/blog/assets/js/12.b445b96f.js"><link rel="prefetch" href="/blog/assets/js/13.cee03eca.js"><link rel="prefetch" href="/blog/assets/js/14.f046a3aa.js"><link rel="prefetch" href="/blog/assets/js/15.0dada98d.js"><link rel="prefetch" href="/blog/assets/js/16.bffc821f.js"><link rel="prefetch" href="/blog/assets/js/17.63b388fe.js"><link rel="prefetch" href="/blog/assets/js/18.8d645869.js"><link rel="prefetch" href="/blog/assets/js/19.5de568aa.js"><link rel="prefetch" href="/blog/assets/js/20.69ac0e74.js"><link rel="prefetch" href="/blog/assets/js/21.81e114d9.js"><link rel="prefetch" href="/blog/assets/js/22.392a44e0.js"><link rel="prefetch" href="/blog/assets/js/23.bc0f7f09.js"><link rel="prefetch" href="/blog/assets/js/24.8f7a67e8.js"><link rel="prefetch" href="/blog/assets/js/25.7b20b221.js"><link rel="prefetch" href="/blog/assets/js/26.83d235ca.js"><link rel="prefetch" href="/blog/assets/js/27.2e139bf4.js"><link rel="prefetch" href="/blog/assets/js/28.608ba0fd.js"><link rel="prefetch" href="/blog/assets/js/29.c9b381a5.js"><link rel="prefetch" href="/blog/assets/js/30.5e9943d1.js"><link rel="prefetch" href="/blog/assets/js/31.3dce4761.js"><link rel="prefetch" href="/blog/assets/js/32.d13bf354.js"><link rel="prefetch" href="/blog/assets/js/33.6868eb11.js"><link rel="prefetch" href="/blog/assets/js/34.03a0a69a.js"><link rel="prefetch" href="/blog/assets/js/35.acea0da3.js"><link rel="prefetch" href="/blog/assets/js/36.2339db8d.js"><link rel="prefetch" href="/blog/assets/js/37.0571cb31.js"><link rel="prefetch" href="/blog/assets/js/38.5b9806b1.js"><link rel="prefetch" href="/blog/assets/js/39.7cb0a79a.js"><link rel="prefetch" href="/blog/assets/js/4.5e0b3ac7.js"><link rel="prefetch" href="/blog/assets/js/40.078df9c5.js"><link rel="prefetch" href="/blog/assets/js/41.51f3f019.js"><link rel="prefetch" href="/blog/assets/js/42.3d3dda36.js"><link rel="prefetch" href="/blog/assets/js/43.18f33d8f.js"><link rel="prefetch" href="/blog/assets/js/44.b5f0bd42.js"><link rel="prefetch" href="/blog/assets/js/46.5e2c916c.js"><link rel="prefetch" href="/blog/assets/js/47.26d0af21.js"><link rel="prefetch" href="/blog/assets/js/48.1f83d2f4.js"><link rel="prefetch" href="/blog/assets/js/49.e76f81ed.js"><link rel="prefetch" href="/blog/assets/js/5.9708defc.js"><link rel="prefetch" href="/blog/assets/js/50.84e13683.js"><link rel="prefetch" href="/blog/assets/js/51.88942bce.js"><link rel="prefetch" href="/blog/assets/js/52.1879e1e3.js"><link rel="prefetch" href="/blog/assets/js/53.abad1ff2.js"><link rel="prefetch" href="/blog/assets/js/54.3a01f449.js"><link rel="prefetch" href="/blog/assets/js/55.20129eb5.js"><link rel="prefetch" href="/blog/assets/js/56.e7ef489f.js"><link rel="prefetch" href="/blog/assets/js/57.ccc72b94.js"><link rel="prefetch" href="/blog/assets/js/58.deb8e570.js"><link rel="prefetch" href="/blog/assets/js/59.c89cf7d3.js"><link rel="prefetch" href="/blog/assets/js/6.84e7c2f0.js"><link rel="prefetch" href="/blog/assets/js/60.76f091f0.js"><link rel="prefetch" href="/blog/assets/js/61.b68ed005.js"><link rel="prefetch" href="/blog/assets/js/62.d2e4bf39.js"><link rel="prefetch" href="/blog/assets/js/63.7099c007.js"><link rel="prefetch" href="/blog/assets/js/64.94ef9dfb.js"><link rel="prefetch" href="/blog/assets/js/65.8039aa42.js"><link rel="prefetch" href="/blog/assets/js/66.f3b5cb14.js"><link rel="prefetch" href="/blog/assets/js/67.8e7f692e.js"><link rel="prefetch" href="/blog/assets/js/7.dc596dd5.js"><link rel="prefetch" href="/blog/assets/js/8.5a0ceb4e.js"><link rel="prefetch" href="/blog/assets/js/9.5b549ad7.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.1d7c383d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>CT's blog</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>study, research, record, work</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>freeway</span>
            
          <!---->
          2025
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/avator.jpg" alt="CT's blog" class="logo"> <span class="site-name">CT's blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Html/" class="nav-link"><i class="undefined"></i>
  Html
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Css/" class="nav-link"><i class="undefined"></i>
  Css
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/JavaScript/" class="nav-link"><i class="undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-suggestion"></i>
      项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Android/" class="nav-link"><i class="undefined"></i>
  Android
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Blog/" class="nav-link"><i class="undefined"></i>
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/QD/" class="nav-link"><i class="undefined"></i>
  QD
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-suggestion"></i>
      面试
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/面试/" class="nav-link"><i class="undefined"></i>
  面经
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/interview/" class="nav-link"><i class="undefined"></i>
  面试问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Leetcode/" class="nav-link"><i class="undefined"></i>
  Leetcode
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/bushu/" class="nav-link"><i class="undefined"></i>
  部署
</a></li></ul></div></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  归档
</a></div><div class="nav-item"><a href="/blog/categories/Atomic/" class="nav-link"><i class="iconfont reco-document"></i>
  Atomic
</a></div><div class="nav-item"><a href="https://github.com/freewayHYW" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/blog/avator.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    freeway
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>57</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>8</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Html/" class="nav-link"><i class="undefined"></i>
  Html
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Css/" class="nav-link"><i class="undefined"></i>
  Css
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/JavaScript/" class="nav-link"><i class="undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-suggestion"></i>
      项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Android/" class="nav-link"><i class="undefined"></i>
  Android
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Blog/" class="nav-link"><i class="undefined"></i>
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/QD/" class="nav-link"><i class="undefined"></i>
  QD
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-suggestion"></i>
      面试
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/面试/" class="nav-link"><i class="undefined"></i>
  面经
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/interview/" class="nav-link"><i class="undefined"></i>
  面试问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Leetcode/" class="nav-link"><i class="undefined"></i>
  Leetcode
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/bushu/" class="nav-link"><i class="undefined"></i>
  部署
</a></li></ul></div></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  归档
</a></div><div class="nav-item"><a href="/blog/categories/Atomic/" class="nav-link"><i class="iconfont reco-document"></i>
  Atomic
</a></div><div class="nav-item"><a href="https://github.com/freewayHYW" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>面试问题-JS</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>freeway</span>
            
          <!---->
          2025
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">面试问题-JS</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>freeway</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2023/2/18</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>front-end</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-判断变量是数组还是对象"><a href="#_1-判断变量是数组还是对象" class="header-anchor">#</a> 1. 判断变量是数组还是对象</h2> <ol><li>instanceof</li> <li>constructor</li> <li>isArray()</li> <li>Object.prototype.toString.call(a)</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

a<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// 该变量转化为代表其类型的string：</span>
consol<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [object Array]</span>
consol<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [object Object]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token comment">// 那么为什么一定要调用原型链上的toString呢：</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1,2</span>
<span class="token comment">// 数组、函数是Object实例，其上的toString()返回的是对应字符串</span>
</code></pre></div><h3 id="_1-1-类型判断"><a href="#_1-1-类型判断" class="header-anchor">#</a> 1.1 类型判断</h3> <ol><li><p>typeof：对于基础数据类型，除null都可以判断（为object），对于引用数据类型，除函数外，均显示为object</p></li> <li><p>Object.prototype.toString.call()：判断typeof为object的具体类型</p> <p>变量本身上的tostring和Object原型上的toString不一样。</p> <p>'hello'.tostring = 'hello'</p> <p>Object.prototype.toString.call('hello') = [object String]</p> <p><strong>Object对象</strong>和它的<strong>原型链</strong>上各自有一个<code>toString()</code>方法，第一个返回的是一个函数，第二个返回的是值类型。通过call将this指向obj。</p></li> <li><p>instanceof：基于原型链的查询，只要处于原型链中，判断永远为true（用于判断引用类型数据，基础类型数据需结合typeof重定义）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myInstanceof</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//基本数据类型直接返回false</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> left <span class="token operator">!==</span> <span class="token string">'object'</span> <span class="token operator">||</span> left <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">//getProtypeOf是Object对象自带的一个方法，能够拿到参数的原型对象</span>
<span class="token keyword">let</span> proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//查找到尽头，还没找到</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">//找到相同的原型对象</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> right<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">myInstanceof</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">myInstanceof</span><span class="token punctuation">(</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
</code></pre></div></li> <li><p>Object.is和===和==</p> <p>==：比较运算符，两边值类型不同的时候，先进行类型转换，再比较</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// true</span>
<span class="token comment">// 类型转换[]=&gt;0,![]=&gt;false=&gt;0</span>
</code></pre></div><p>===：严格比较运算符，不做类型转换，类型不同就是不等</p> <p>Object.is()：用来比较两个值是否严格相等的方法，与<code>===</code>的行为基本一致。与===不同之处：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">+</span><span class="token number">0</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">0</span> <span class="token comment">//true</span>
Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span> <span class="token comment">// false</span>
Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div></li> <li><p>类型转换</p> <p>转换成数字 ：string数字对应转换，<strong>字母转化为NaN</strong>；空数组为0，存在数字元素的数组转化为该数字，其他情况为NaN；<strong>null转化为0，除数组的其他引用类型为NaN</strong></p> <p>转换成布尔值 ：number除0、-0、NaN都为true；string除空串都为true；undefined、null为false；<strong>引用类型都为true</strong></p> <p>转换成字符串：<strong>boolean、函数、symbol=&gt;”true“</strong>；数组[1,2]=&gt;&quot;1,2&quot;；对象=&gt;&quot;[Object Object]&quot;</p></li></ol> <h3 id="_1-2-null和undefined和nan"><a href="#_1-2-null和undefined和nan" class="header-anchor">#</a> 1.2 null和undefined和NaN</h3> <p>null和undefined 两者相等，但是当两者做全等比较时，两者又不等。</p> <p>null： object类型，代表“空值”，代表一个空对象指针</p> <p>undefined： undefined类型</p> <p>NaN: 表示非数字的值,与自身不相等<strong>NaN!==NaN</strong>,</p> <p><strong>typeof NaN为“number”</strong></p> <p><strong>typeof null为“object”</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token comment">// true,undefined和null在if语句中，都会被自动转为false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// false</span>

<span class="token comment">// 转为数值时，值不一样，undefined转为数值NaN，null转为数值0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>

<span class="token comment">// 空值合并运算符（??），当左侧的操作数为 null 或者 undefined 时，返回其右侧操作数0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">??</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token operator">??</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// 0</span>

<span class="token comment">// 可选链操作符(?.)允许读取位于连接对象链深处的属性的值，而不必明确验证链中的每个引用是否有效。 (null 或者 undefined) 的情况下不会引起错误。</span>
</code></pre></div><h2 id="_2-js防抖节流函数"><a href="#_2-js防抖节流函数" class="header-anchor">#</a> 2. js防抖节流函数</h2> <p>闭包的实际运用</p> <p><strong>防抖函数</strong>：当持续触发时间，一定时间内没有触发，事件处理函数才执行一次，若设定时间到之前又触发一次，则重新开始延时</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> timer
<span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>

<span class="token comment">// 完整非闭包</span>
<span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementTagName</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">// 防抖函数</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">dalay<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    <span class="token comment">// 第一次时timer变为undefined，但实际要让下面的timer一直存在在内存中，即要使内存泄漏 =&gt; 闭包（函数里return出函数）</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
input<span class="token punctuation">.</span><span class="token function">addEventListenr</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 防抖函数（闭包优化版）</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">dalay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token comment">// 此变量一直在内存中</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 输出结果 =&gt; 改在函数外输出怎么办？</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> debounceFunc <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
input<span class="token punctuation">.</span><span class="token function">addEventListenr</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">debounceFunc</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 防抖函数（闭包优化+回调函数输出版）</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">dalay<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token comment">// 此变量一直在内存中</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> debounceFunc <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
input<span class="token punctuation">.</span><span class="token function">addEventListenr</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">debounceFunc</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>节流函数</strong>：一段时间内只执行一次事件处理函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">thro</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timeout
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span><span class="token punctuation">{</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                timeout <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token function">thro</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre></div><p>防抖在连续的事件，只需触发一次回调的场景有：</p> <ul><li><p>搜索框搜索输入。只需用户最后一次输入完，再发送请求</p></li> <li><p>手机号、邮箱验证输入检测</p></li> <li><p>窗口大小<code>resize</code>。只需窗口调整完成后，计算窗口大小。防止重复渲染。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">{</span>
                           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span>
                           <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> runDebounce <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token function">runDebounce</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
</code></pre></div></li></ul> <p>节流在间隔一段时间执行一次回调的场景有：</p> <ul><li><p>滚动加载，加载更多或滚到底部监听</p></li> <li><p>搜索框，搜索联想功能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">thro</span><span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timeout
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span><span class="token punctuation">{</span>
        timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
            timeout <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> runThro <span class="token operator">=</span> <span class="token function">thro</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token function">runThro</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="_3-预编译"><a href="#_3-预编译" class="header-anchor">#</a> 3. 预编译</h2> <p>预编译：作用域创建阶段</p> <p><strong>函数预编译过程</strong></p> <ol><li>创建AO对象</li> <li>找形参和变量的声明，作为AO对象的属性名，值为undefined</li> <li>实参和形参相统一</li> <li>找函数声明，若和变量同名，会覆盖变量的声明</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">123</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token number">677</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">var</span> <span class="token function-variable function">b</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 1. 创建AO对象</span>
<span class="token constant">AO</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 2. 找形参和变量的声明，作为AO对象的属性名，值为undefined</span>
<span class="token constant">AO</span><span class="token operator">:</span><span class="token punctuation">{</span>
    a<span class="token operator">:</span><span class="token keyword">undefined</span>
    c<span class="token operator">:</span><span class="token keyword">undefined</span>
    d<span class="token operator">:</span><span class="token keyword">undefined</span>
    b<span class="token operator">:</span><span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
<span class="token comment">// 3. 形参和实参相统一</span>
<span class="token constant">AO</span><span class="token operator">:</span><span class="token punctuation">{</span>
    a<span class="token operator">:</span><span class="token keyword">undefined</span> <span class="token number">1</span>
    c<span class="token operator">:</span><span class="token keyword">undefined</span> <span class="token number">2</span>
    d<span class="token operator">:</span><span class="token keyword">undefined</span>
    b<span class="token operator">:</span><span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
<span class="token comment">// 4. 找函数声明，若和变量同名，会覆盖变量的声明</span>
<span class="token constant">AO</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function-variable function">a</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function-variable function">c</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    d<span class="token operator">:</span><span class="token keyword">undefined</span>
    b<span class="token operator">:</span><span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
<span class="token comment">// 预编译结束，js逐行执行</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// function a(){}</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">123</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 123</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">// function c(){}</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token number">677</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
    <span class="token keyword">var</span> <span class="token function-variable function">b</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// function(){}</span>
    <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">// function c(){}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>全局预编译过程</strong></p> <ol><li>创建GO（Global Object，全局执行期上下文，在浏览器中为window）对象；</li> <li>寻找var变量声明，并赋值为undefined；</li> <li>寻找function函数声明，并赋值为函数体；</li> <li>执行代码。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    y <span class="token operator">=</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
y <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
z <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment">// 1. 创建GO（Global Object，全局执行期上下文，在浏览器中为window）对象；</span>
<span class="token constant">GO</span>：<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 2. 寻找var变量声明，并赋值为undefined；</span>
<span class="token constant">GO</span>：<span class="token punctuation">{</span>
    x<span class="token operator">:</span><span class="token keyword">undefined</span>
    y<span class="token operator">:</span><span class="token keyword">undefined</span>
    z<span class="token operator">:</span><span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
<span class="token comment">// 3. 寻找function函数声明，并赋值为函数体；</span>
<span class="token constant">GO</span>：<span class="token punctuation">{</span>
    x<span class="token operator">:</span><span class="token keyword">undefined</span>
    y<span class="token operator">:</span><span class="token keyword">undefined</span>
    z<span class="token operator">:</span><span class="token keyword">undefined</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 4. 执行代码。</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// x:1</span>
    y <span class="token operator">=</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// y:0 z:0</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
y <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// y:4</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
z <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment">// z:4</span>
</code></pre></div><h2 id="_4-this指向"><a href="#_4-this指向" class="header-anchor">#</a> 4. this指向</h2> <p><strong>函数直接被调用，this指向window</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nihao&quot;</span><span class="token punctuation">)</span> <span class="token comment">// nihao window</span>
</code></pre></div><p><strong>函数作为对象的方法调用，谁调的（上一级），this指向谁</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">&quot;张三&quot;</span>
    <span class="token function-variable function">run</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
person<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment">// 30 person</span>
</code></pre></div><p><strong>练习</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token number">222</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token number">111</span><span class="token punctuation">,</span>
    <span class="token function-variable function">say</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fun <span class="token operator">=</span> a<span class="token punctuation">.</span>say
<span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// window 222</span>
a<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a 111</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token number">333</span>
    <span class="token function-variable function">say</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// window 222</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
b<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>say<span class="token punctuation">)</span> <span class="token comment">// window 222</span>
b<span class="token punctuation">.</span>say <span class="token operator">=</span> a<span class="token punctuation">.</span>say 
b<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// b 333</span>
</code></pre></div><p><strong>onclick和addEventerListener中 this 默认指向绑定事件的元素。</strong></p> <p><strong>new+构造函数</strong></p> <p>原本的构造函数是window对象的方法，如果不用new操作符而直接调用，那么构造函数的执行对象就 是window，即this指向了window。<strong>现在用new操作符后，this就指向了新生成的对象。</strong></p> <h2 id="_5-箭头函数的this"><a href="#_5-箭头函数的this" class="header-anchor">#</a> 5. 箭头函数的this</h2> <p>箭头函数的this是在<strong>定义函数的时候</strong>绑定的。</p> <p>箭头函数没有自己的this，其this是外层代码块的this。<strong>不能作为构造函数</strong>，没有显式原型（prototype），但是有隐式原型（<code>__proto__</code>=Function.prototype）,它new出来的实例无法通过原型链指向它的prototype。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">11</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    x<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
    <span class="token function-variable function">say</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
person<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 11 箭头函数与say平级，也就是说箭头函数所在对象为person，而person的父执行上下文就是window</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    birth<span class="token operator">:</span> <span class="token number">1999</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getAge</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>birth<span class="token punctuation">;</span>
        <span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>birth<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// this =&gt; person 箭头函数在getAge()中定义，getAge方法的父执行上下文为person</span>
</code></pre></div><h2 id="_6-手写call和apply"><a href="#_6-手写call和apply" class="header-anchor">#</a> 6. 手写call和apply</h2> <h3 id="_6-1-call和apply作用"><a href="#_6-1-call和apply作用" class="header-anchor">#</a> 6.1 call和apply作用</h3> <p>用来重新定义函数的执行环境，即this的指向</p> <p>call的作用：</p> <ol><li>判断数组和对象</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span>property<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span>
</code></pre></div><ol start="2"><li>伪数组转数组</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span>arguments<span class="token punctuation">]</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span>property<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>改变this指向</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'科比'</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>手写call</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'科比'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 参数接收的是 改变this指向的参数</span>
Function<span class="token punctuation">.</span>property<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 这里的this是谁？ 必须是一个function</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    context <span class="token operator">=</span> context <span class="token operator">||</span> window
    
    <span class="token comment">// 拿到除第一个参数外的参数</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token comment">// 1 2 3</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// function(){ return this.name }</span>
    
    <span class="token comment">// 要在person1上面来假设有一个方法</span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>getName<span class="token punctuation">.</span><span class="token function">myCall</span><span class="token punctuation">(</span>person1，<span class="token number">1</span>，<span class="token number">2</span>，<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 科比</span>
</code></pre></div><p><strong>手写apply</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'科比'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 参数接收的是 改变this指向的参数</span>
Function<span class="token punctuation">.</span>property<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 这里的this是谁？ 必须是一个function</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    context <span class="token operator">=</span> context <span class="token operator">||</span> window
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// function(){ return this.name }</span>
    
    <span class="token comment">// 要在person1上面来假设有一个方法</span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1,2,3]</span>
    
    <span class="token keyword">var</span> result 
    <span class="token keyword">if</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn
    
    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>getName<span class="token punctuation">.</span><span class="token function">myCall</span><span class="token punctuation">(</span>person1，<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 科比</span>
</code></pre></div><h3 id="_6-2-bind"><a href="#_6-2-bind" class="header-anchor">#</a> 6.2 bind</h3> <p><strong>call()、apply()、bind() 都是用来重定义 this 这个对象的</strong></p> <p><strong>bind和call传入参数一样，但是bind返回的是函数：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">&quot;xiaozhang&quot;</span><span class="token punctuation">,</span>
    objAge<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span>
    <span class="token function-variable function">myFunc</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">&quot;德玛&quot;</span>，
    age<span class="token operator">:</span><span class="token number">99</span>
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// xiaozhang undefined</span>
obj<span class="token punctuation">.</span><span class="token function">myFun</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>；　　　　<span class="token comment">// 德玛 99</span>
obj<span class="token punctuation">.</span><span class="token function">myFun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>　　　 <span class="token comment">// 德玛 99</span>
obj<span class="token punctuation">.</span><span class="token function">myFun</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>　　　<span class="token comment">// 德玛 99</span>
</code></pre></div><h2 id="_7-事件循环机制event-loop"><a href="#_7-事件循环机制event-loop" class="header-anchor">#</a> 7. 事件循环机制event-loop</h2> <p>js运行机制就是事件循环，js为单线程，面对耗时的异步任务（宏任务、微任务），会放在队列中，等待同步任务执行结束再循环查看微任务队列和宏任务队列并执行。</p> <p>组成：调用栈、微任务队列、宏任务队列</p> <p>event-loop开始时，会从全局逐行执行，遇到函数调用，会压入到调用栈中，被压入的函数被称为帧。当函数返回后会从调用栈中弹出</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 调用栈先压入fun2(),输出结果2，再压入fun1(),输出1后，弹出fun1(),输出3，最后弹出fun2()</span>
</code></pre></div><p>对于js的异步操作（宏任务），如fetch、setTimeout、setInterval，压入到调用栈中的时候里面的消息会进入宏任务队列，待调用栈清空才执行宏任务队列的信息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 调用栈先压入fun2(),再压入setTimeout(打印2的语句压入宏队列中)，再压入fun1(),输出结果1，弹出fun1(),再输出结果3,弹出setTimeout和fun2()，最后输出2</span>
</code></pre></div><p>promise、async、await的异步操作（微任务）的时候会加入到微任务队列中去，调用栈清空后立即执行。注意promise本身是同步任务，promise.then\promise.catch是异步任务的微任务。<strong>微任务优于宏任务</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 同步任务先进入调用栈，输出4，resolve(5)进入微任务队列，setTimeout进入宏任务队列，再输出1 3，调用栈的同步任务执行完毕。</span>
<span class="token comment">// 循环查看微任务队列，执行resolve(5)，输出5，微任务清空。</span>
<span class="token comment">// 循环查看宏任务队列，执行setTimeout，输出2。</span>
</code></pre></div><p>练习</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span>
<span class="token comment">// 1 3 5 4 2</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">200</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
<span class="token comment">// 0 100 300 200 200</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>sync <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">handle</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'结束'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 结束 1 2 4</span>
</code></pre></div><p><strong>process.nextTick</strong></p> <p>process.nextTick 是一个独立于 eventLoop 的任务队列。 在<strong>每一个 eventLoop 阶段完成后会去检查这个队列</strong>，如果里面有任务，会让这部分任务 <strong>优先于微任务</strong> 执 行。</p> <h2 id="_9-深浅拷贝"><a href="#_9-深浅拷贝" class="header-anchor">#</a> 9. 深浅拷贝</h2> <p>基础数据类型：number string boolean null undefined symbol（<strong>存在栈里</strong>）</p> <p>引用数据类型：object 数组 set map （<strong>存在堆里，栈里存指针地址，指向堆</strong>）</p> <p><strong>闭包的变量存在堆内存中</strong></p> <p>NaN：JS 中的特殊值，表示非数字，NaN 不是数字，但是他的<strong>数据类型是数字</strong>，它不 等于任何值，包括自身，在布尔运算时被当做 false，NaN 与任何数运算得到的结果都是 NaN</p> <h3 id="_9-1-赋值和深浅拷贝的区别"><a href="#_9-1-赋值和深浅拷贝的区别" class="header-anchor">#</a> 9.1 赋值和深浅拷贝的区别</h3> <p>赋值（对于基础数据，赋值是在栈中开辟新的栈内存存值；对于引用数据，赋值只是创建了新的栈内存存变量指针地址，没在堆内创建新的对象）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span>  <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">&quot;zhangsan&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> person <span class="token comment">// 在栈里赋值了一个新的指针地址，和person一样指向同一个堆里的内容</span>
person2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;科比&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 科比</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 科比</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">26</span>
person <span class="token operator">=</span> <span class="token punctuation">{</span>
name<span class="token operator">:</span> <span class="token string">'hzj'</span><span class="token punctuation">,</span>
age<span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> person
<span class="token punctuation">}</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token punctuation">{</span>
name<span class="token operator">:</span> <span class="token string">'fyq'</span><span class="token punctuation">,</span>
age<span class="token operator">:</span> <span class="token number">19</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">// -&gt; p1：{name: “fyq”, age: 26}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span> <span class="token comment">// -&gt; p2：{name: “hzj”, age: 18}</span>
<span class="token comment">// 在函数传参的时候传递的是对象在堆中的内存地址值，test函数中的实参person是p1对象的内存地址，通过调用person.age = 26确实改变了p1的值，但随后person变成了另一块内存空间的地址，并且在最后将这另外一份内存空间的地址返回，赋给了p2。</span>
</code></pre></div><p>深浅拷贝针对于拷贝引用数据类型而言</p> <p>浅拷贝（创建一个新的对象，并拷贝值。若拷贝的属性是基础数据类型，拷贝的是其值，若为引用数据类型，拷贝的是内存地址）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. JS循环遍历实现</span>
<span class="token keyword">var</span> person <span class="token operator">=</span>  <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">&quot;zhangsan&quot;</span>
    hobby<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;篮球&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">shallowCopy</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            newObj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newObj
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token function">shallowCopy</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>

person2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;科比&quot;</span> <span class="token comment">// 拷贝的属性为基础数据类型，拷贝的是其值</span>
person2<span class="token punctuation">.</span>hobby<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;冰球&quot;</span> <span class="token comment">// 拷贝的属性为引用数据类型，拷贝的是内存地址</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// zhangsan</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 科比</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span> <span class="token comment">// [&quot;冰球&quot;]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span> <span class="token comment">// [&quot;冰球&quot;]</span>

<span class="token comment">// 2. Object.assign()</span>
Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token operator">...</span>sources<span class="token punctuation">)</span>    【target：目标对象】，【souce：源对象（可多个）】

<span class="token comment">// 3. 函数库lodash的_.clone方法</span>
<span class="token keyword">var</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> newObj <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>oldObj<span class="token punctuation">)</span>

<span class="token comment">// 4. 扩展运算符...</span>
<span class="token keyword">let</span> newObj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>oldObj<span class="token punctuation">]</span>

<span class="token comment">// 5. 数组方法concat()、slice()，返回一个新的数组对象</span>
</code></pre></div><p>深拷贝（如果拷贝的属性是引用类型，会在堆里开辟一个新的房间）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 深拷贝的应用：当你想使用某个对象的值，在修改时不想修改原对象，那么可以用深拷贝弄一个新的内存对象。</span>
<span class="token comment">// 1. JSON.parse(JSON.stringify(oldObj))</span>
  <span class="token comment">// 但是方法不能用这个方法进行深拷贝</span>

<span class="token comment">// 2. 函数库lodash的_.cloneDeep方法</span>

<span class="token comment">// 3. jQuery.extend()方法</span>

<span class="token comment">// 4. JS递归实现</span>
<span class="token keyword">function</span> <span class="token function">cloneDeep</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> source<span class="token punctuation">;</span> <span class="token comment">// 非对象返回自身</span>
  <span class="token keyword">var</span> target <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归调用</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isObject</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10-优化条件语句"><a href="#_10-优化条件语句" class="header-anchor">#</a> 10. 优化条件语句</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">printDetail</span><span class="token punctuation">(</span><span class="token parameter">animal</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>animal<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>animal<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>animal<span class="token punctuation">.</span>gender<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    result <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>animal<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>animal<span class="token punctuation">.</span>gender<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>animal<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    result <span class="token operator">=</span> <span class="token string">'no animal gender'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                result <span class="token operator">=</span> <span class="token string">'no animal name'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            result <span class="token operator">=</span> <span class="token string">'no animal type'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token string">'no animal'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre></div><p>优化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">printDetail</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>type<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gender<span class="token punctuation">}</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gender<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'no animal gender'</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'no animal name'</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'no animal type'</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>animal<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>animal<span class="token punctuation">.</span>gender<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>animal<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_11-js数据类型"><a href="#_11-js数据类型" class="header-anchor">#</a> 11. js数据类型</h2> <p>基础数据类型：Number String Boolean Null Undefined Symbol</p> <p>引用数据类型：Object Array Function Date RegExp Math Map Set</p> <h3 id="_11-1-symbol"><a href="#_11-1-symbol" class="header-anchor">#</a> 11.1 Symbol</h3> <ol><li>唯一性：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'pg'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'pg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><ol start="2"><li>数据类型的修饰</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Symbol('pg')中的'pg'是一种修饰，用于区分多个Symbol数据</span>
</code></pre></div><ol start="3"><li>其他数据类型的转换</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Symbol能转化为字符串或布尔值</span>
<span class="token function">String</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>作为对象的属性</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> mySymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 第一种写法</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
a<span class="token punctuation">[</span>mySymbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hello!'</span>

<span class="token comment">// 第二种写法</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>mySymbol<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'hello!'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 第三种写法</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> mySymbol<span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'Hello!'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 以上三种打印a[mySymbol]为&quot;Hello!&quot;</span>
</code></pre></div><ol start="5"><li>对象属性的遍历</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'小明'</span>，
    age<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'level'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'A'</span>
<span class="token punctuation">}</span>

<span class="token comment">// for of 不具备迭代器的接口 Symbol.iterator</span>
<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token keyword">in</span> person<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['name', 'age']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ['name', 'age']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [Symbol(level)]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ['name', 'age', Symbol(level)]</span>
</code></pre></div><ol start="6"><li>Symbol.for()和Symbol.keyFor()</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Symbol.for()和Symbol()均是创建Symbol类型，但创建机制不同。用Symbol.for('foo')创建前会查找全局，看是否已经有Symbol.for('foo'),如果有就用之前有的。而Symbol()是直接创建一个新的Symbol类型</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1 <span class="token operator">===</span> s2<span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// Symbol.keyFor()返回一个已登记的Symbol类型值的key</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token comment">// &quot;foo&quot;</span>

<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre></div><ol start="6"><li>Symbol的应用</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> game <span class="token operator">=</span> <span class="token punctuation">{</span>
    pg<span class="token operator">:</span><span class="token string">'后卫'</span>，
    sg<span class="token operator">:</span><span class="token string">'后卫'</span>，
    sf<span class="token operator">:</span><span class="token string">'前锋'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createRole</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">===</span> game<span class="token punctuation">.</span>pg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;后卫&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> game<span class="token punctuation">.</span>sg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;中卫&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> type <span class="token operator">===</span> game<span class="token punctuation">.</span>sf<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;前锋&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">createRole</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>pg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//后卫 中卫</span>
<span class="token comment">// 若只打印一个，保证唯一性可将game定义为：</span>
<span class="token keyword">var</span> game <span class="token operator">=</span> <span class="token punctuation">{</span>
    pg<span class="token operator">:</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'pg'</span><span class="token punctuation">)</span>，
    sg<span class="token operator">:</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'sg'</span><span class="token punctuation">)</span>，
    sf<span class="token operator">:</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'sf'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_11-2-null"><a href="#_11-2-null" class="header-anchor">#</a> 11.2 null</h3> <p><strong>null不是对象</strong>。虽然 typeof null 会输出 object，但是这只是 JS 存在的一个悠久 Bug。在 JS 的最初版本中使用的 是 32 位系统，为了性能考虑使用低位存储变量的类型信息，<strong>000 开头代表是对象然而 null 表示为全零</strong>，所以将它错误的判断为 object 。</p> <h3 id="_11-3-bigint"><a href="#_11-3-bigint" class="header-anchor">#</a> 11.3 Bigint</h3> <p>BigInt是一种新的数据类型，用于当整数值大于Number数据类型支持的范围时。</p> <p>创建BigInt，只需要在数字末尾追加n即可</p> <p>不允许在bigint和 Number 之间进行混合操作，不能将BigInt传递给Web api和内置的 JS 函数</p> <h3 id="_11-4-map"><a href="#_11-4-map" class="header-anchor">#</a> 11.4 Map</h3> <p>Map是类似于object的一种键值对集合，区别在Map的键可以是非字符串，其他数据类型包括对象都可以成为Map的键。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// value</span>
a<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
a<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><p>js中只有Map，没有hashMap，在java中，hashMap是Map的底层实现方式，在js中用原始Map就够了</p> <p>因为Map和Set一样不能直接用下标访问，所以遍历得用for of或者foreach</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'ww'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// for of</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">of</span> map<span class="token punctuation">)</span><span class="token punctuation">{</span>
    consle<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// ['zs',12],['ww',18]</span>
<span class="token punctuation">}</span>
<span class="token comment">// foreach</span>
map<span class="token punctuation">.</span><span class="token function">foreach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment">// zs 12 , ww 18</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 使用Map提供的遍历器</span>
map<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回所用键名</span>
map<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回所有值</span>
map<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回所有成员</span>

</code></pre></div><h3 id="_11-5-set"><a href="#_11-5-set" class="header-anchor">#</a> 11.5 Set</h3> <p>Set类似于数组结构，里面的元素没有重复</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1,2,3,4]</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">)</span> <span class="token comment">// [1,2,3,4,66]</span>
set<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
set<span class="token punctuation">.</span>size <span class="token comment">// 4</span>
set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
set<span class="token punctuation">.</span>clear <span class="token comment">// 清空</span>

<span class="token comment">// 遍历方法</span>
set<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
set<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
set<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">of</span> set<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="_12-数组去重"><a href="#_12-数组去重" class="header-anchor">#</a> 12. 数组去重</h2> <h3 id="_12-1-set去重"><a href="#_12-1-set去重" class="header-anchor">#</a> 12.1 Set去重</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1,3,4,5,23]</span>
</code></pre></div><h3 id="_12-2-两次循环"><a href="#_12-2-两次循环" class="header-anchor">#</a> 12.2 两次循环</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">:</span><span class="token string">'sam'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span><span class="token string">'casea'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                j<span class="token operator">--</span>
                len<span class="token operator">--</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_12-3-indexof、includes、filter实现"><a href="#_12-3-indexof、includes、filter实现" class="header-anchor">#</a> 12.3 indexOf、includes、filter实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// indexOf</span>
<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            arr1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr1
<span class="token punctuation">}</span>

<span class="token comment">// includes</span>
<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>arr1<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            arr1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr1
<span class="token punctuation">}</span>

<span class="token comment">// filter</span>
<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> index <span class="token comment">// 找到item第一次出现的索引值</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment">// 0 1 2 3 0 1</span>
</code></pre></div><h2 id="_13-发布-订阅模式和观察者模式"><a href="#_13-发布-订阅模式和观察者模式" class="header-anchor">#</a> 13. 发布-订阅模式和观察者模式</h2> <h3 id="_13-1-发布订阅模式"><a href="#_13-1-发布订阅模式" class="header-anchor">#</a> 13.1 发布订阅模式</h3> <p>发布-订阅模式：当一个对象的状态发生改变时，所有依赖于它的对象都将得到状态改变的通知。</p> <p>过程：<strong>订阅者</strong>把自己想订阅的事件<strong>注册</strong>到<strong>调度中心</strong>，当<strong>发布者</strong>发布该<strong>事件</strong>到调度中心，也就是该事件触发时，由调度中心统一调度订阅者注册到调度中心的处理代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> shopObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
shopObj<span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// 增加订阅者</span>
shopObj<span class="token punctuation">.</span><span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
<span class="token punctuation">}</span> 

<span class="token comment">// 发布消息</span>
shopObj<span class="token punctuation">.</span><span class="token function-variable function">trigger</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> key <span class="token operator">=</span> Array<span class="token punctuation">.</span>property<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
    <span class="token keyword">var</span> fns <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fns<span class="token operator">||</span>fns<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> fn<span class="token punctuation">;</span> fn<span class="token operator">=</span>fns<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 取消订阅</span>
shopObj<span class="token punctuation">.</span><span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> fns <span class="token operator">=</span> list<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fns<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>
        fns <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>fns<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> fns<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> _fn <span class="token operator">=</span>fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>_fn <span class="token operator">===</span> fn<span class="token punctuation">)</span><span class="token punctuation">{</span>
                fns<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

shopObj<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">小红订阅了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
shopObj<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">小黑订阅了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
shopObj<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span>
shopObj<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// on是订阅，emit是发布</span>
<span class="token keyword">let</span> emailCenter <span class="token operator">=</span> <span class="token punctuation">{</span>
    _callback<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token operator">||</span><span class="token keyword">this</span><span class="token punctuation">.</span>callback<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;订阅列表为空&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">method</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
             <span class="token keyword">return</span> <span class="token boolean">false</span>
         <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">var</span> _fn <span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>_fn <span class="token operator">===</span> callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>_callback<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">zhangsan</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;张三订阅：&quot;</span><span class="token operator">+</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">lisi</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;李四订阅：&quot;</span><span class="token operator">+</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">wangwu</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;王五订阅：&quot;</span><span class="token operator">+</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 订阅</span>
emailCenter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;three&quot;</span><span class="token punctuation">,</span> zhangsan<span class="token punctuation">)</span>
emailCenter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;four&quot;</span><span class="token punctuation">,</span> lisi<span class="token punctuation">)</span>
emailCenter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;five&quot;</span><span class="token punctuation">,</span> wangwu<span class="token punctuation">)</span>
<span class="token comment">// 发送</span>
emailCenter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;four&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;中央日报&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 李四订阅：中央日报</span>
emailCenter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;five&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;人民日报&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 王五订阅：人民日报</span>
<span class="token comment">// 取消</span>
emailCenter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;five&quot;</span><span class="token punctuation">,</span> wangwu<span class="token punctuation">)</span>
emailCenter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;five&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;人民日报&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 订阅列表为空</span>
</code></pre></div><p>应用：同一组件内模块间的通信、跨组件间通信</p> <h3 id="_13-2-观察者模式"><a href="#_13-2-观察者模式" class="header-anchor">#</a> 13.2 观察者模式</h3> <p>观察者直接订阅主题，当主题被激活，会触发观察者里的事件（将订阅主题的观察者放入主题的数组中，通过遍历数组中观察者进而触发其事件）</p> <div class="language-js extra-class"><pre class="language-js"><code>Class <span class="token function">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        thies<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;happy&quot;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>，
    <span class="token function">attach</span><span class="token punctuation">(</span><span class="token parameter">them</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>them<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>，
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state
        <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">them</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            them<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>them<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> see their children are </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Class <span class="token function">Observer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">}</span>，
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">subject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>them<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> see their children </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> are </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> baby <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token string">&quot;baby&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">&quot;dad&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> mother <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">&quot;mom&quot;</span><span class="token punctuation">)</span>

baby<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>father<span class="token punctuation">)</span>
baby<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>mother<span class="token punctuation">)</span>
baby<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">&quot;unhappy&quot;</span><span class="token punctuation">)</span> 
<span class="token comment">// dad see their children baby are unhappy</span>
<span class="token comment">// mom see their children baby are unhappy</span>
</code></pre></div><h2 id="_14-闭包"><a href="#_14-闭包" class="header-anchor">#</a> 14. 闭包</h2> <p>为什么闭包</p> <ol><li>避免变量被污染</li> <li>私有化（库的封装）</li> <li>保存变量，常驻内存</li></ol> <p>应用：处理私有数据，其他见2节节流防抖</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">makeCounter</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> privateCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        privateCounter <span class="token operator">+=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">increment</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">decrement</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> privateCounter<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_15-new"><a href="#_15-new" class="header-anchor">#</a> 15. new</h2> <p>new 操作符新建了一个空对象，这个对象原型指向构造函数的 prototype（person1.<code>_proto_</code>=Person.prototype），执行构造函数后返回这个实例对象。</p> <ul><li>第一步: 创建一个Object对象实例。</li> <li>第二步: 将构造函数的执行对象赋给新生成的这个实例。</li> <li>第三步: 执行构造函数中的代码</li> <li>第四步: 返回新生成的对象实例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;sam&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 补充</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有_proto_原型链</span>
<span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 有原型链</span>

<span class="token comment">// 实现new</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>_proto_ <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    person1 <span class="token operator">=</span> result
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    person1 <span class="token operator">=</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_16-事件委托"><a href="#_16-事件委托" class="header-anchor">#</a> 16. 事件委托</h2> <p>事件委托本质上是利⽤了浏览器<strong>事件冒泡</strong>的机制。</p> <p>因为事件在冒泡过程中会上传到⽗节点， 并且⽗节点可以通过<strong>事件对象获取到⽬标节点</strong>，因此可以把⼦节点的监听函数定义在⽗节点上， 由<strong>⽗节点的监听函数统⼀处理多个⼦元素的事件</strong>，这种⽅式称为事件代理。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ul<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>add li<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span>
    ul<span class="token punctuation">.</span><span class="token function-variable function">conclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        event <span class="token operator">=</span> event <span class="token operator">||</span> window<span class="token punctuation">.</span>event
        <span class="token keyword">let</span> target <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>nodeName <span class="token operator">==</span> <span class="token string">&quot;LI&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
        li<span class="token punctuation">.</span>textContent <span class="token operator">=</span> ul<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_17-封装dom库"><a href="#_17-封装dom库" class="header-anchor">#</a> 17. 封装dom库</h2> <p>匿名自执行函数：1.引入便执行一次 2. 防止变量污染</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dom,js</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>$ <span class="token operator">=</span> <span class="token function-variable function">jquery</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nodeSelector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> nodes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> nodeSelector <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> temp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>nodeSelector<span class="token punctuation">)</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> temp<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            nodes<span class="token punctuation">.</span>length <span class="token operator">=</span> temp<span class="token punctuation">.</span>length
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;please enter string&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// add function</span>
        nodes<span class="token punctuation">.</span><span class="token function-variable function">addClass</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">classes</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> classNames <span class="token operator">=</span> classes<span class="token punctuation">.</span><span class="token function">splite</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
            classNames<span class="token punctuation">.</span><span class="token function">foreach</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> nodes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>// use
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>444<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./dom.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.p4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>优化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dom,js</span>
<span class="token keyword">let</span> $ <span class="token operator">=</span> jQuery <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token function-variable function">jquery</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nodeSelector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>nodeSelector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    jquery<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">each</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
         <span class="token function-variable function">addClass</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">classes</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> classNames <span class="token operator">=</span> classes<span class="token punctuation">.</span><span class="token function">splite</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
            classNames<span class="token punctuation">.</span><span class="token function">foreach</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    obj<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nodeSelector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">jquery</span><span class="token punctuation">(</span>nodeSelector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_18-promise-async-await-generator"><a href="#_18-promise-async-await-generator" class="header-anchor">#</a> 18. promise+async/await+generator</h2> <h3 id="_18-1-promise"><a href="#_18-1-promise" class="header-anchor">#</a> 18.1 <strong>promise</strong></h3> <p>实现异步编程，其为构造函数，传参参数为函数（resolve, reject）=&gt; {..}</p> <p>之前用的是回调函数，用promise更加灵活，避免回调地狱，支持链式调用</p> <p>.then方法用来预先指定成功和失败的回调函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">fail</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>.catch方法用来捕获与处理错误</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>相当于<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
</code></pre></div><p>应用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> isRem <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> getLv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>isRem<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> lv <span class="token operator">=</span> <span class="token punctuation">{</span>
            color<span class="token operator">:</span><span class="token string">&quot;red&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>lv<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;forget&quot;</span><span class="token punctuation">)</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token function-variable function">buyLip</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">lv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> lip <span class="token operator">=</span> <span class="token punctuation">{</span>
        color<span class="token operator">:</span><span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span><span class="token punctuation">{</span>
        lip<span class="token operator">:</span>lip<span class="token punctuation">,</span>
        lv<span class="token operator">:</span>lv
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">testFn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    getLv<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">lv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> lip <span class="token operator">=</span> <span class="token punctuation">{</span>
            color<span class="token operator">:</span><span class="token string">&quot;red&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> msg <span class="token operator">=</span><span class="token punctuation">{</span>
            lip<span class="token operator">:</span>lip<span class="token punctuation">,</span>
            lv<span class="token operator">:</span>lv
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rejecct</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rejecct<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">testFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>手写promise</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPromise</span><span class="token punctuation">(</span><span class="token parameter">excutor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'pending'</span>
    self<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
    self<span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    self<span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    self<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
            self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
            self<span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    self<span class="token punctuation">.</span><span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
            self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'rejected'</span>
            self<span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">excutor</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>resolve<span class="token punctuation">,</span>self<span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// then()</span>
    myPromise<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                  <span class="token comment">//获取回调函数的执行结果</span>
                  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token comment">//判断</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//如果是 Promise 类型的对象</span>
                    result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
                      <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">//结果的对象状态为『成功』</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">run</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">run</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                self<span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">run</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token function-variable function">onResolved</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">run</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>  
    <span class="token punctuation">}</span>
    
    <span class="token comment">// catch()</span>
    myPromise<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">catch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// resolve()</span>
    myPromise<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//返回promise对象</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">myPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">myPromise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token function">r</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token function">j</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">//状态设置为成功</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//添加 reject 方法</span>
    myPromise<span class="token punctuation">.</span><span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">myPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> p1 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">r</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>**Promise.all：**有一个promise失败，那么Promise.all返回的promise对象失败。返回的 promise 的完成状态的结果都是一个数组</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function-variable function">all</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> len <span class="token operator">=</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 为什么不直接 promise[i].then, 因为promise[i]可能不是一个promise</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promise<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
index<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>**Promise.race：**只要有一个 promise 执行完，直接 resolve 并停止执行。</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function-variable function">race</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> len <span class="token operator">=</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promise<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_18-2-async-await"><a href="#_18-2-async-await" class="header-anchor">#</a> 18.2 async/await</h3> <p><strong>async</strong>：async 函数返回的是一个 Promise 对象。如果在函数中 return 一个直接量，async 会把这个直接量通过 Promise.resolve() 封装成 Promise 对象。</p> <p><strong>await</strong>：await 等待的是一个表达式（如async函数），这个表达式的计算结果是 Promise 对象或者其它值。（await必须在async里用）</p> <p>如果它等到的不是一个 Promise 对象，那 await 表达式的运算结果就是它等到的东西。</p> <p>如果它等到的是一个 Promise 对象，await 就忙起来了，它会阻塞后面的代码，等着 Promise 对象 resolve，然后得到 resolve 的值，作为 await 表达式的运算结果。</p> <p><strong>promise和async/await的对比</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 前面没加async是因为函数本身就返回的是promise</span>
 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;long_time_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// promise</span>
<span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;got&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// async/await</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">function</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step1 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">function</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step2 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">function</span> <span class="token function">step3</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step3 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// promise</span>
<span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> time1 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
 <span class="token function">step1</span><span class="token punctuation">(</span>time1<span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time2</span> <span class="token operator">=&gt;</span> <span class="token function">step2</span><span class="token punctuation">(</span>time2<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time3</span> <span class="token operator">=&gt;</span> <span class="token function">step3</span><span class="token punctuation">(</span>time3<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">result is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// async/await 更加清晰</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> time1 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> time2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step1</span><span class="token punctuation">(</span>time1<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> time3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step2</span><span class="token punctuation">(</span>time2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step3</span><span class="token punctuation">(</span>time3<span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">result is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>async/await异常处理用try{}catch{}</p> <p>promise异常处理用.catch()函数，会捕获promise内的throw错误和reject抛出的错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> authorized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>authorized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 抛出方法一</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'未登录，获取用户信息失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 抛出方法二</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'未登录，获取用户信息失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> id<span class="token punctuation">,</span>
      username<span class="token operator">:</span> <span class="token string">'admin'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.catch被调用：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">try/catch被调用：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_18-3-generator"><a href="#_18-3-generator" class="header-anchor">#</a> 18.3 <strong>generator</strong></h3> <p>一个函数的内部状态的遍历器，每调用一次生成器，函数的内部状态发生一次改变。可用于自定义迭代器</p> <p>是一个<strong>带 星号 的&quot;函数&quot;</strong>（注意：它并不是真正的函数)，可以通过 <strong>yield 关键字 暂停执行 和 恢复执行</strong> 的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">sayHW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">&quot;!!!&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> say <span class="token operator">=</span> <span class="token function">sayHW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 sayHw() 后，程序会阻塞住，不会执行任何语句。</span>
<span class="token comment">// 调用say.next()后，程序继续执行，直到遇到 yield 程序暂停。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>say<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'hello', done: false} </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>say<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'world', done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>say<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// { value: '!!!', done: true}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>say<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// { value: undefined, done: true}</span>
<span class="token comment">// next 方法返回一个对象， 有两个属性: value 和 done 。value 为当前 yield 后面的结果 ，done表示是否执行完 ，遇到了 return 后， done 会由 false 变为 true 。</span>
</code></pre></div><p><em><em>yield</em>:</em>* 一个生成器要调用另一个生成器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">yield</span> <span class="token number">1</span>
<span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">gen2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">yield</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 2 3 4</span>
</code></pre></div><p>生成器实现机制——<strong>协程</strong></p> <p>协程：一个线程可以有多个协程，一个线程一次只能执行一个协程。比如当前执行 A 协程，另外还有一个 B 协程，如果 想要执行 B 的任务，就必须在 <strong>A 协程中将 JS 线程的控制权转交给 B协程</strong> ，那么现在 B 执行，A 就相当于 处于暂停的状态。</p> <h2 id="_19-原型"><a href="#_19-原型" class="header-anchor">#</a> 19. 原型</h2> <p>原型：在 JavaScript 中，每当定义一个对象（函数也是对象）时候，对象中都会包含一些预定义的属性。其中每个函数对象都有一个<strong>prototype 属性，这个属性指向函数的原型对象</strong>，<strong>使用原型对象的好处是所有对象实例共享它所包含的属性和方法</strong></p> <p>原型链：每个对象通过<code>__proto__</code> 指针指向其原型对象，并从中继承方法和属性，同时原型对象也可能拥有原型，这样一层一层，最终指向 null (Object.proptotype.<code>__proto__</code>指向的是null)。这种关系被称为原型链，通过原型链一个对象可以拥有定义在其他对象中的属性和方法</p> <p>区别：prototype是构造函数的属性，<code>__proto__</code>是实例的属性，两者指向同一对象</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a07dd027689d461eba1dc6a6a4b3c9eb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p> <p>es5中js用构造函数来创造实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 构造函数</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成实例</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在构造函数中通过this赋值的属性或者方法，是每个实例的实例属性以及实例方法，无法共享公共属性。所以又设计出了一个原型对象prototype，来存储这个构造函数的公共属性以及方法。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 构造函数</span>
    <span class="token keyword">function</span> <span class="token function">Preson</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 所有实例共享的公共方法</span>
    <span class="token class-name">Preson</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">说：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>word<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Preson</span><span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个Person实例对象</span>
    p1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'say'</span><span class="token punctuation">)</span> <span class="token comment">// false 说明不是定义在其本身上的</span>
    p1<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用公共方法 打印：张三说：hello world</span>
</code></pre></div><p>为什么我们构造的p1这个实例对象，它可以调用到Person这个构造函数的原型对象上的方法呢？</p> <p>每个通过构造函数创建出来的实例对象，其本身有个属性<code>__proto__</code>，这个属性会指向该实例对象的构造函数的原型对象</p> <p>当访问一个对象的某个属性时，会先在这个对象本身属性上查找，如果没有找到，则会通过它的<code>__proto__</code>隐式属性，找到它的构造函数的原型对象prototype，如果还没有找到就会再在其构造函数的prototype的<code>__proto__</code>中查找</p> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// 构造函数</span>
    <span class="token keyword">function</span> <span class="token function">Preson</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 所有实例共享的公共方法</span>
    <span class="token class-name">Preson</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">说：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>word<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Preson</span><span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个Person实例对象</span>
    <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Preson</span><span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新创建一个Proson实例对象</span>
    p1<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用公共方法</span>
    p1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'say'</span><span class="token punctuation">)</span> <span class="token comment">// false 说明不是定义在其本身上的</span>
    p1<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function-variable function">do</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'往原型对象中添加方法'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    p2<span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印出了-往原型对象中添加方法</span>
</code></pre></div><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af9b2d74dee044e2b83f332fbe511880~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p> <p>题目：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// a._proto_ = A.prototype; A.prototype._proto_ = Object.prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>a<span class="token punctuation">,</span> a<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined, 2</span>
<span class="token comment">// A._proto_ = Function.prototype; Function.prototype._proto_ = Object.prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 2</span>
</code></pre></div><h2 id="_20-继承"><a href="#_20-继承" class="header-anchor">#</a> 20. 继承</h2> <p>1.实现继承首先需要一个父类，在js中实际上是没有类的概念，在es6中class虽然很像类，但实际上只是es5上语法糖而已</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">People</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//属性</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token operator">=</span> name <span class="token operator">||</span> Annie
  <span class="token comment">//实例方法</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sleep</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'正在睡觉'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//原型方法</span>
<span class="token class-name">People</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">food</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'正在吃：'</span> <span class="token operator">+</span> food<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>1.原型链继承</strong></p> <p>父类的实例作为子类的原型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Woman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
<span class="token punctuation">}</span>
<span class="token class-name">Woman</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Woman</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'haixia'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> womanObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>优点：简单易于实现，父类的新增的实例与属性子类都能访问</p> <p>缺点：可以在子类中增加实例属性，如果要新增加原型属性和方法需要在new 父类构造函数的后面，无法实现多继承，创建子类实例时，不能向父类构造函数中传参数</p> <p><strong>2.借用构造函数call继承（伪造对象、经典继承）</strong></p> <p>复制父类的实例属性给子类</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Woman</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">//继承了People</span>
  <span class="token function">People</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//People.call(this，'wangxiaoxia'); </span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'renbo'</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> womanObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>优点：解决了子类构造函数向父类构造函数中传递参数，可以实现多继承（call或者apply多个父类）</p> <p>缺点：方法都在构造函数中定义，无法复用，<strong>不能继承原型属性/方法，只能继承父类的实例属性和方法</strong></p> <p><strong>3.实例继承（原型式继承）</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Wonman</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'wangxiaoxia'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> wonmanObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wonman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>优点：不限制调用方式，简单，易实现</p> <p>缺点：不能多次继承</p> <p><strong>4.组合式继承</strong>(组合原型链和call)</p> <p>调用父类构造函数，继承父类的属性，通过将父类实例作为子类原型，实现函数复用</p> <div class="language-text extra-class"><pre class="language-text"><code>function People(name,age){
  this.name = name || 'wangxiao'
  this.age = age || 27
}
People.prototype.eat = function(){
  return this.name + this.age + 'eat sleep'
}

function Woman(name,age){
  People.call(this,name,age)
}
Woman.prototype = new People();
Woman.prototype.constructor = Woman;
let wonmanObj = new Woman(ren,27);
wonmanObj.eat(); 
</code></pre></div><p>缺点：由于调用了两次父类，所以产生了<strong>两份实例</strong></p> <p>优点：函数可以复用，不存在引用属性问题，可以继承属性和方法，并且可以继承原型的属性和方法</p> <p>5.<strong>寄生组合继承</strong></p> <p>通过寄生的方式来修复组合式继承的不足，完美的实现继承</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//父类</span>
<span class="token keyword">function</span> <span class="token function">People</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'wangxiao'</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age <span class="token operator">||</span> <span class="token number">27</span>
<span class="token punctuation">}</span>
<span class="token comment">//父类方法</span>
<span class="token class-name">People</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token string">'eat sleep'</span>
<span class="token punctuation">}</span>
<span class="token comment">//子类</span>
<span class="token keyword">function</span> <span class="token function">Woman</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//继承父类属性</span>
  <span class="token function">People</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//继承父类方法</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 创建空类</span>
  <span class="token keyword">let</span> <span class="token function-variable function">Super</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Super</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">People</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  <span class="token comment">//父类的实例作为子类的原型</span>
  <span class="token class-name">Woman</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//修复构造函数指向问题</span>
<span class="token class-name">Woman</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Woman<span class="token punctuation">;</span>
<span class="token keyword">let</span> womanObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>6.es6继承</strong></p> <p>代码量少，易懂</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//class 相当于es5中构造函数</span>
<span class="token comment">//class中定义方法时，前后不能加function，全部定义在class的protopyte属性中</span>
<span class="token comment">//class中定义的所有方法是不可枚举的</span>
<span class="token comment">//class中只能定义方法，不能定义对象，变量等</span>
<span class="token comment">//class和方法内默认都是严格模式</span>
<span class="token comment">//es5中constructor为隐式属性</span>
<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'wang'</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token string">'27'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> eat food</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//继承父类</span>
<span class="token keyword">class</span> <span class="token class-name">Woman</span> <span class="token keyword">extends</span> <span class="token class-name">People</span><span class="token punctuation">{</span> 
   <span class="token function">constructor</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'ren'</span><span class="token punctuation">,</span>age <span class="token operator">=</span> <span class="token string">'27'</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
     <span class="token comment">//继承父类属性</span>
     <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token punctuation">}</span> 
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
     <span class="token comment">//继承父类方法</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">let</span> wonmanObj<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token string">'xiaoxiami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
wonmanObj<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>ES5继承和ES6继承的区别</strong></p> <p>ES5继承首先是在子类中创建自己的this指向，最后将方法添加到this中</p> <p>Child.prototype=new Parent() || Parent.apply(this) || Parent.call(this)</p> <p>ES6继承是使用关键字先创建父类的实例对象this，最后在子类class中修改this</p> <h2 id="_21-事件流"><a href="#_21-事件流" class="header-anchor">#</a> 21. 事件流</h2> <p>事件流描述的是页面接收事件的顺序。</p> <p><strong>三个阶段：</strong></p> <p>1.捕获阶段：事件对象从目标的祖先节点Window开始传播直至目标。
2.目标阶段：事件对象传递到事件目标。如果事件的type属性表明后面不会进行冒泡操作，那么事件到此就结束了。
3.冒泡阶段：事件对象以一个相反的方向进行传递，从目标开始，到Window对象结束</p> <p><strong>addEventListener(eventName, function, type)</strong></p> <p>type描述事件，true为捕获，false为冒泡（默认）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;div1&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;div2&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token keyword">var</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;div1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> div2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;div2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

div1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;div1--捕获阶段&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;div2--捕获阶段&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;div1--冒泡阶段&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;div2--冒泡阶段&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 点击div2：</span>
<span class="token comment">// div1--捕获阶段</span>
<span class="token comment">// div2--捕获阶段</span>
<span class="token comment">// div2--冒泡阶段</span>
<span class="token comment">// div1--冒泡阶段</span>
</code></pre></div><p><strong>事件冒泡：</strong></p> <p>**当一个元素接收到事件的时候，会把他接收到的事件传给自己的父级，一直到window。**如果它的父级元素也有某个事件函数，当执行完它的事件函数后，也就会执行它父级的事件函数。</p> <p><strong>阻止冒泡：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在要执行的点击事件代码后面添加</span>
e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//W3C阻止冒泡方法</span>
e<span class="token punctuation">.</span>cancelBubble <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//IE阻止冒泡方法</span>
</code></pre></div><p><strong>阻止捕获：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 为true时，在要阻止的事件后面添加</span>
e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不会阻断相同元素的后续的相同事件的执行</span>
e<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会阻断相同元素的后续的相同事件的执行</span>
</code></pre></div><p><strong>先冒泡后捕获：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> 一个元素绑定两个addEventListener，将设置为<span class="token boolean">false</span>的监听事件放在设置为<span class="token boolean">true</span>的监听事件前面
<span class="token number">2.</span> 在执行捕获时，设置setTimeOut（方法名，<span class="token number">0</span>），将其放入宏任务中
</code></pre></div><h2 id="_22-图片加载"><a href="#_22-图片加载" class="header-anchor">#</a> 22. 图片加载</h2> <p><strong>预加载：提前加载图片，当用户需要查看时可直接从本地缓存中渲染。</strong></p> <p>方法一：css法</p> <ul><li>创建用来预加载的标签</li> <li>给标签使用背景图，背景图的路径是需要预加载的图片资源。并且将图片移到看不见的地方，或缩小到看不见。<strong>不能用 display=none , 否则预加载会失效</strong></li> <li>当使用到已经预加载好的图片时，会直接使用缓存好的图片资源，而不需要向服务器发送请求。</li></ul> <p>方法二：js法</p> <ul><li>将需要预加载的图片资源的 URL 保存在数组里</li> <li>循环遍历 URL 数组执行以下步骤，直到结束</li> <li>创建一个 image 对象 <code>new Image()</code></li> <li>将 image 对象的 src 属性的值指定为预加载图片的 URL</li></ul> <p><strong>懒加载：懒加载的主要目的是作为服务器前端的优化，减少请求数或延迟请求数</strong>。</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe783697937a429693c3c5f2e2011059~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="请添加图片描述"></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time2.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time3.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time4.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time5.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img2/time6.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> num <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> seeHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span> <span class="token comment">// 显示内容/可见区域的高度（元素内容+内边距）</span>
        <span class="token keyword">let</span> scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token comment">//有滚动条的情况下，为元素可视区域距离元素顶部的像素，也就是已经滚动了多少距离</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">&lt;</span> seeHeight <span class="token operator">+</span> scrollTop<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 照片距离视口顶部的距离小于可见区域高度+向下滚动的距离=&gt;加载</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;./img2/time.gif&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">=</span> img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;data-src&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>本质：两者的行为是相反的，一个是提前加载，一个是迟缓甚至不加载。 懒加载对服务器前端有一定的缓解压力作用，预加载则会增加服务器前端压力。</p> <h2 id="_23-鼠标事件"><a href="#_23-鼠标事件" class="header-anchor">#</a> 23. 鼠标事件</h2> <table><thead><tr><th>事件类型</th> <th>说明</th></tr></thead> <tbody><tr><td>click</td> <td><strong>单击</strong>鼠标左键时发生。当用户的<strong>焦点在按钮上并按了 Enter 键</strong>时，同样会触发这个事件</td></tr> <tr><td>dblclick</td> <td><strong>双击</strong>鼠标左键时发生。</td></tr> <tr><td>mousedown</td> <td><strong>按下任意</strong>一个鼠标按钮时发生</td></tr> <tr><td><strong>mouseenter/mouseleave</strong></td> <td>鼠标移入所在元素的边界时发生（只会执行鼠标所进入的元素上的mouseenter）</td></tr> <tr><td>mouseover/mouseout</td> <td>鼠标移入某个元素上时发生（移入子元素，会通过<strong>冒泡</strong>，触发父元素上的mouseover）</td></tr> <tr><td>mouseup</td> <td><strong>松开任意</strong>一个鼠标按钮时发生</td></tr> <tr><td>mousemove</td> <td>鼠标在某个元素上时<strong>持续移动发生</strong></td></tr></tbody></table> <p><img src="https://img2018.cnblogs.com/blog/1670358/201909/1670358-20190918160838058-597135305.png" alt="img"></p> <h2 id="_24-鼠标拖拉功能"><a href="#_24-鼠标拖拉功能" class="header-anchor">#</a> 24. 鼠标拖拉功能</h2> <p>补充知识：</p> <p><strong>offset系列</strong></p> <ol><li>offsetTop：元素到offsetParent顶部的距离</li> <li>offsetParent：距离元素最近的一个具有定位的祖宗元素（relative，absolute，fixed），若祖宗都不符合条件，offsetParent为body</li> <li>offsetHeight = div的height + 上下padding + 上下boder</li></ol> <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e70bf2d5a2044b89cb3ea03a4534457~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="offset.png"></p> <p><strong>client系列</strong></p> <ol><li>clientHeigh = height + 上下padding</li> <li>clientTop = boder.top(上边框的宽度)</li></ol> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/346c669d683b421db3608fd3ecb25be7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="client.png"></p> <p><strong>scroll系列</strong></p> <ol><li>scrollHeight：元素展现所有内容所需的真实高度（可视区域高度+被隐藏区域高度）</li> <li>scrollTop：元素层顶部到可视区域顶部的距离（滚动的距离）</li></ol> <p><strong>y系列</strong></p> <ol><li>e.offsetY： 鼠标距离点击容器的垂直距离</li> <li>e.clientY： 鼠标在浏览器可视区域的垂直坐标</li> <li>e.screenY：鼠标距离显示屏上边的垂直坐标</li> <li>e.pageY：鼠标距离元素上边的垂直坐标</li> <li>window.scrollY：元素已滚动的垂直像素</li></ol> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/1/17134e89da2d591b~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="img"></p> <p><strong>原生js实现拖拉</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
            <span class="token selector">.ball</span> <span class="token punctuation">{</span>
                <span class="token property">width</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
                <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
                <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
                <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
                <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ball<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
            const ball = document.querySelector(&quot;.ball&quot;);
            const container = document.documentElement;
            let isDragging = false;
            let x, y, l, t;
            const ballDown = (e) =&gt; {
                isDragging = true;
                //获取开始拖拽时鼠标的x坐标和y坐标
                x = e.clientX;
                y = e.clientY;
                //获取左部和顶部的偏移量
                l = ball.offsetLeft;
                t = ball.offsetTop;
            };
            container.addEventListener(&quot;mousedown&quot;, ballDown);
            const drag = (e) =&gt; {
                if (!isDragging) return;
                //获取x和y
                const nx = e.clientX;
                const ny = e.clientY;
                //计算移动后的左偏移量和顶部的偏移量，y-t就是鼠标距离所拖拉元素顶边的距离
                const nl = nx - (x - l);
                const nt = ny - (y - t); // 移动后，拖拉元素左上角的y坐标
                //重新设置小球位置
                ball.style.left = nl + &quot;px&quot;;
                ball.style.top = nt + &quot;px&quot;;
            }
            container.addEventListener(&quot;mousemove&quot;, drag);
            const stopDrag = () =&gt; {
                isDragging = false;
            }
            container.addEventListener(&quot;mouseup&quot;, stopDrag);
</code></pre></div><p>鼠标事件：mousedown、mousemove、mouseup</p> <p><strong>h5 dragApi</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ball<span class="token punctuation">&quot;</span></span> <span class="token attr-name">draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ondragstart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dragstart(event)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ondragover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>drag(event)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ondragend</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stopDrag<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> ball <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#ball&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">;</span>
        <span class="token keyword">let</span> isDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> l<span class="token punctuation">,</span> t<span class="token punctuation">,</span>nl<span class="token punctuation">,</span>nt<span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">dragstart</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          isDragging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token comment">//获取开始拖拽时鼠标的x坐标和y坐标</span>
          x <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
          y <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>
          <span class="token comment">//获取左部和顶部的偏移量</span>
          l <span class="token operator">=</span> ball<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>
          t <span class="token operator">=</span> ball<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">drag</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isDragging<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token comment">//获取x和y</span>
          <span class="token keyword">const</span> nx <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
          <span class="token keyword">const</span> ny <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nx<span class="token punctuation">,</span>ny<span class="token punctuation">)</span>
          <span class="token comment">//计算移动后的左偏移量和顶部的偏移量，y-t就是鼠标距离所拖拉元素顶边的距离</span>
          nl <span class="token operator">=</span> nx <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
          nt <span class="token operator">=</span> ny <span class="token operator">-</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移动后，拖拉元素左上角的y坐标</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nl<span class="token punctuation">,</span>nt<span class="token punctuation">)</span>
          <span class="token comment">//重新设置小球位置</span>
          ball<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> nl <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
          ball<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> nt <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">stopDrag</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/735e2c529fd14b44ae1bbb90ec36c33a~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image-20220314095928431.png"></p> <ul><li><code>dragstart</code>：事件主体是源元素，在开始拖放源元素时触发。</li> <li><code>dragover</code>：事件主体是目标元素，在源元素被拖放在目标元素内移动时触发。</li> <li><code>dragend</code>：事件主体是源元素，在整个拖放操作结束时触发。</li> <li><code>darg</code>：事件主体是源元素，在正在拖放源元素时触发。</li> <li><code>dragenter</code>：事件主体是目标元素，在源元素进入目标元素时触发。</li> <li><code>dragleave</code>：事件主体是目标元素，在源元素移出目标元素是触发。</li> <li><code>drop</code>：事件主体是目标元素，在目标元素完全接受被拖放元素时触发。</li></ul> <h2 id="_25-js的异步加载"><a href="#_25-js的异步加载" class="header-anchor">#</a> 25. js的异步加载</h2> <p>如果没有defer或async属性，<strong>浏览器会立即加载并执行相应的脚本</strong>。它不会等待后续加载的文档元素，读取到就会开始加载和执行，这样就<strong>阻塞了后续文档的加载</strong>。</p> <p>即，<strong>defer 和 async属性都是去异步加载外部的JS脚本文件，它们都不会阻塞页面的解析</strong></p> <p><strong>区别</strong>：</p> <ul><li><p>多个带async属性的标签，不能保证加载的顺序；</p></li> <li><p>多个带<strong>defer属性的标签，按照加载顺序执行</strong></p></li> <li><p>async属性，表示后续文档的加载和执行与js脚本的<strong>加载和执行是并行进行</strong>的，即异步执行；<strong>当然js执行时，html的解析会停止</strong></p> <p><img src="https://pic3.zhimg.com/80/v2-74febba4b5c4b370a7a7edea01cb5cd2_720w.webp" alt="img"></p></li> <li><p>defer属性，加载后续文档的过程和js脚本的<strong>加载(此时仅加载不执行)是并行进行</strong>的(异步)，<strong>js脚本需要等到文档所有元素解析完成之后才执行，DOMContentLoaded事件触发执行之前。</strong></p> <p><img src="https://pic3.zhimg.com/80/v2-e5fef119db5c0039aa3fb6674a5d3026_720w.webp" alt="img"></p></li> <li><p>即：文档的加载和js脚本的加载都是并行的，但是，<strong>defer时文档解析完才执行js，async时文档解析和js执行也是并行的，执行js时停止解析文档。</strong></p></li></ul> <p>如果script标签同时具备async和defer =&gt; 效果和async是一样的</p> <p><strong>以上均针对script放在head的时候</strong>，<strong>也可以把script标签放到body之后去写</strong>，这样，可<strong>不写async和defer</strong>也能防止script标签阻塞html解析。</p> <p>多个async：多个具有async属性的script标签之间也没有明确的执行顺序先后关系。浏览器各自认为合适的时候以合适的顺序执行</p> <p>多个defer：所有的脚本会在所有的文档内容解析完成后执行，但是浏览器会保证它们按照顺执行。</p> <p>module类型的script标签：自动的添加defer属性</p> <h2 id="_27-eval"><a href="#_27-eval" class="header-anchor">#</a> 27. eval()</h2> <p><code>eval()</code> 函数会将传入的<strong>字符串</strong>当做 <strong>JavaScript 代码进行执行</strong>，如果传入的字符串是<strong>表达式则返回表达式求值结果</strong>，否则返回 <code>undefined</code> 。</p> <p>应该避免使用eval，不安全，非常耗性能。</p> <h2 id="_28-前端模块化commonjs、amd、cmd和es6模块系统"><a href="#_28-前端模块化commonjs、amd、cmd和es6模块系统" class="header-anchor">#</a> 28. 前端模块化commonJS、AMD、CMD和ES6模块系统</h2> <p>前端模块化：提高代码复用率，方便进行代码的管理。通常一个文件就是一个模块，有自己的作用域，只向外暴露特定的变量和函数。</p> <p><strong>commonJS</strong>：node.js常用，module、exports、require、global。module.exports定义导出模块，require<strong>同步</strong>加载引入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义模块math.js</span>
<span class="token keyword">var</span> basicNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">//在这里写上需要向外暴露的函数、变量</span>
  add<span class="token operator">:</span> add<span class="token punctuation">,</span>
  basicNum<span class="token operator">:</span> basicNum
<span class="token punctuation">}</span>

<span class="token comment">// 引用自定义的模块时，参数包含路径，可省略.js</span>
<span class="token keyword">var</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 引用核心模块时，不需要带路径</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>AMD.js：异步加载模块，介绍用require.js实现AMD规范的模块化：require.config()指定引用路径，define()定义模块，require()加载模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** 网页中引入require.js及main.js **/</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;js/require.js&quot;</span> data<span class="token operator">-</span>main<span class="token operator">=</span><span class="token string">&quot;js/main&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">/** main.js 入口文件/主模块 **/</span>
<span class="token comment">// 首先用config()指定各模块路径和引用名</span>
require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseUrl<span class="token operator">:</span> <span class="token string">&quot;js/lib&quot;</span><span class="token punctuation">,</span>
  paths<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;jquery&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jquery.min&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//实际路径为js/lib/jquery.min.js</span>
    <span class="token string">&quot;underscore&quot;</span><span class="token operator">:</span> <span class="token string">&quot;underscore.min&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义math.js模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> basicNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        add<span class="token operator">:</span> add<span class="token punctuation">,</span>
        basicNum <span class="token operator">:</span>basicNum
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义一个依赖underscore.js的模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'underscore'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">classify</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    _<span class="token punctuation">.</span><span class="token function">countBy</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> num <span class="token operator">&gt;</span> <span class="token number">30</span> <span class="token operator">?</span> <span class="token string">'old'</span> <span class="token operator">:</span> <span class="token string">'young'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    classify <span class="token operator">:</span>classify
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 引用模块，将模块放在[]内</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token string">'math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$<span class="token punctuation">,</span> math</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> sum <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#sum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>CMD.js：与AMD很类似，不同点在于：AMD 推崇依赖前置、提前执行，CMD推崇依赖就近、延迟执行。</p> <p>ES6 Module：export、import</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** 定义模块 math.js **/</span>
<span class="token keyword">var</span> basicNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> basicNum<span class="token punctuation">,</span> add <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** 引用模块 **/</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> basicNum<span class="token punctuation">,</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ele<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">99</span> <span class="token operator">+</span> basicNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义输出</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> basicNum<span class="token punctuation">,</span> add <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//引入</span>
<span class="token keyword">import</span> math <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ele<span class="token punctuation">.</span>textContent <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">99</span> <span class="token operator">+</span> math<span class="token punctuation">.</span>basicNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用<code>import</code>命令的时候，用户需要知道所要加载的变量名或函数名。其实ES6还提供了<code>export default</code>命令，为模块指定默认输出，对应的<code>import</code>语句不需要使用大括号。这也更趋近于ADM的引用写法。</p> <p>commonJS和ES6的差异：</p> <ol><li>commonJS输出的是值的拷贝，即模块内的变化影响不到输出的值。ES6输出的是值的引用，动态的。</li> <li>commonJS是运行时加载，即输入时先加载整个模块，生成对象，再从对象中读取方法。ES6为编译时加载，引入可以指定加载某个输出值。</li></ol> <h2 id="_29-和-、以及object-is的区别"><a href="#_29-和-、以及object-is的区别" class="header-anchor">#</a> 29. ==和===、以及Object.is的区别</h2> <p>普通的相等性检查 <code>==</code> 存在一个问题，它不能区分出 <code>0</code> 和 <code>false</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>也同样无法区分空字符串和 <code>false</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">''</span> <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token comment">// true</span>
</code></pre></div><p><strong>严格相等运算符 <code>===</code> 在进行比较时不会做任何的类型转换。</strong></p> <p>换句话说，如果 <code>a</code> 和 <code>b</code> 属于不同的数据类型，那么 <code>a === b</code> 不会做任何的类型转换而立刻返回 <code>false</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，因为被比较值的数据类型不同</span>
</code></pre></div><p>但是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span> <span class="token comment">// false</span>
<span class="token operator">-</span><span class="token number">0</span> <span class="token operator">===</span> <span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
</code></pre></div><p>而<code>Object.is(valueA,valueB)</code> 以与严格相等运算符相同的方式检查相等性的参数，但有两个区别。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span> <span class="token comment">// true</span>
<span class="token operator">-</span><span class="token number">0</span> <span class="token operator">===</span> <span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><h2 id="_30-settimeout、setinterval-和-requestanimationframe-之间的区别"><a href="#_30-settimeout、setinterval-和-requestanimationframe-之间的区别" class="header-anchor">#</a> 30. setTimeout、setInterval 和 requestAnimationFrame 之间的区别</h2> <p>setTimeout：延时执行代码。由于事件循环，不是百分比准时。</p> <p>setInterval：在指定时间内，重复执行一次代码，同样不准时。</p> <p>requestAnimationFrame：请求动画帧，根据屏幕刷新频率，自动执行代码，无需设置时间。窗口未激活时停止执行。自带函数节流功能。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> progress <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  progress <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timer <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//第一帧渲染</span>
window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_31-性能优化"><a href="#_31-性能优化" class="header-anchor">#</a> 31. 性能优化</h2> <ul><li>减少 HTTP 请求 （合并请求）</li> <li>使用内容发布网络（CDN管理静态大文件）</li> <li>添加本地缓存</li> <li>压缩资源文件</li> <li>将 CSS 样式表放在顶部，把 javascript 放在底部（浏览器的运行机制决定）</li> <li>避免使用 CSS 表达式</li> <li>减少 DNS 查询</li> <li>使用外部 javascript 和 CSS</li> <li>避免重定向</li> <li>图片 lazyLoad</li></ul> <h2 id="_32-js语言特性"><a href="#_32-js语言特性" class="header-anchor">#</a> 32. js语言特性</h2> <ul><li>运行在客户端浏览器上；</li> <li>不用预编译，直接解析执行代码；</li> <li>是弱类型语言，较为灵活；（存放的数据，类型可变）</li> <li>与操作系统无关，跨平台的语言；</li> <li>脚本语言、解释性语言</li> <li>单线程（前面的代码没有运行完，后面的代码必须等待）</li></ul> <h2 id="_33-暂时性死区"><a href="#_33-暂时性死区" class="header-anchor">#</a> 33. 暂时性死区</h2> <p>在代码块内，使用 let、const 命令声明变量之前，该变量都是不可用的。这在语法上， 称为“暂时性死区”</p> <h2 id="_34-实现深拷贝"><a href="#_34-实现深拷贝" class="header-anchor">#</a> 34. 实现深拷贝</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Date<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>constructor <span class="token operator">===</span> RegExp<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj<span class="token punctuation">.</span>constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//保持继承链，解决问题：如果obj中的对象是由构造函数生成的，则使用深拷贝后，会丢弃对象的constructor；</span>
  	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  		<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//不遍历其原型链上的属性</span>
  			<span class="token keyword">const</span> val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  			newObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">:</span> val<span class="token punctuation">;</span> <span class="token comment">// 使用arguments.callee解除与函数名的耦合。</span>
  		<span class="token punctuation">}</span>
  	<span class="token punctuation">}</span>
  	<span class="token keyword">return</span> newObj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="_35-按需加载"><a href="#_35-按需加载" class="header-anchor">#</a> 35. 按需加载</h2> <p>当用户触发了动作时才加载对应的功能。触发的动作，是要看具体的业务场景而言</p> <h2 id="_36-虚拟dom"><a href="#_36-虚拟dom" class="header-anchor">#</a> 36. 虚拟dom</h2> <p>用 JavaScript 对象结构表示 DOM 树的结构；然后用这个树构建一个真正的 DOM 树，插到文档当中。</p> <p>当状态变更的时候，重新构造一棵新的对象树。然后用新的树和旧的树进行比较，记录两棵树差异把所记录的差异应用到所构建的真正的 DOM 树上，视图就更新了。</p> <p>Virtual DOM 本质上就是在 JS 和 DOM 之间做了一个缓存。</p> <h2 id="_37-单例模式"><a href="#_37-单例模式" class="header-anchor">#</a> 37. 单例模式</h2> <p>是指在<strong>一个类只能有一个实例</strong>，即使多次实例化该类，也只返回第一次实例化后的实例对象。</p> <p>单例模式不仅能减少不必要的内存开销, 并且在减少全局的函数和变量冲突也具有重要的意义。</p> <p><strong>惰性单例</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> timeTool <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// _instance作为实例对象最开始赋值为null</span>
  
  <span class="token comment">// init函数是其构造函数，用于实例化对象 </span>
  <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//私有变量</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//公用属性和方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'处理时间工具库'</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getISODate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> now<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getUTCDate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> now<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 返回的是匿名函数用于判断实例是否创建</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>_instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>应用场景</p> <ol><li><p>命名空间</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//开发者A写了一大段js代码</span>
<span class="token keyword">let</span> devA <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//开发者B开始写js代码</span>
<span class="token keyword">let</span> devB <span class="token operator">=</span> <span class="token punctuation">{</span>
  addNumber<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span>

<span class="token comment">//A重新维护该js代码</span>
devA<span class="token punctuation">.</span><span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>管理模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> devA <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//ajax模块</span>
  <span class="token keyword">var</span> ajax <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ajax get调用'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">post</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//dom模块</span>
  <span class="token keyword">var</span> dom <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">create</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//event模块</span>
  <span class="token keyword">var</span> event <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">remove</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    ajax<span class="token operator">:</span> ajax<span class="token punctuation">,</span>
    dom<span class="token operator">:</span> dom<span class="token punctuation">,</span>
    event<span class="token operator">:</span> event
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 有ajax,dom和event三个模块，用同一个命名空间devA来管理。在进行相应操作的时候，只需要devA.ajax.get()进行调用即可</span>
</code></pre></div></li> <li><p>es6将下列代码改为单例模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> products</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>creator <span class="token operator">=</span> creator<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>products <span class="token operator">=</span> products<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> appleCompany <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token string">'苹果公司'</span><span class="token punctuation">,</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'iPhone'</span><span class="token punctuation">,</span> <span class="token string">'iMac'</span><span class="token punctuation">,</span> <span class="token string">'iPad'</span><span class="token punctuation">,</span> <span class="token string">'iPod'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> copyApple <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token string">'苹果公司'</span><span class="token punctuation">,</span> <span class="token string">'阿辉'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'iPhone'</span><span class="token punctuation">,</span> <span class="token string">'iMac'</span><span class="token punctuation">,</span> <span class="token string">'iPad'</span><span class="token punctuation">,</span> <span class="token string">'iPod'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 苹果这么伟大的公司明显有且只有一个, 就是乔爷爷创建的那个, 哪能容别人进行复制？所以appleCompany应该是一个单例</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">SingletonApple</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> products</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//首次使用构造器实例</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>SingletonApple<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>creator <span class="token operator">=</span> creator<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>products <span class="token operator">=</span> products<span class="token punctuation">;</span>
      <span class="token comment">//将this挂载到SingletonApple这个类的instance属性上！！！</span>
      SingletonApple<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> SingletonApple<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> appleCompany <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SingletonApple</span><span class="token punctuation">(</span><span class="token string">'苹果公司'</span><span class="token punctuation">,</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'iPhone'</span><span class="token punctuation">,</span> <span class="token string">'iMac'</span><span class="token punctuation">,</span> <span class="token string">'iPad'</span><span class="token punctuation">,</span> <span class="token string">'iPod'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> copyApple <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SingletonApple</span><span class="token punctuation">(</span><span class="token string">'苹果公司'</span><span class="token punctuation">,</span> <span class="token string">'阿辉'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'iPhone'</span><span class="token punctuation">,</span> <span class="token string">'iMac'</span><span class="token punctuation">,</span> <span class="token string">'iPad'</span><span class="token punctuation">,</span> <span class="token string">'iPod'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 后面创建的copyApple结果还是和第一次创建的一样</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>appleCompany <span class="token operator">===</span> copyApple<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//true</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 优化，静态方法</span>
<span class="token keyword">class</span> <span class="token class-name">SingletonApple</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> products</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>creator <span class="token operator">=</span> creator<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>products <span class="token operator">=</span> products<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//静态方法</span>
  <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> products</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SingletonApple</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> products<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> appleCompany <span class="token operator">=</span> SingletonApple<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'苹果公司'</span><span class="token punctuation">,</span> <span class="token string">'乔布斯'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'iPhone'</span><span class="token punctuation">,</span> <span class="token string">'iMac'</span><span class="token punctuation">,</span> <span class="token string">'iPad'</span><span class="token punctuation">,</span> <span class="token string">'iPod'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> copyApple <span class="token operator">=</span> SingletonApple<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'苹果公司'</span><span class="token punctuation">,</span> <span class="token string">'阿辉'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'iPhone'</span><span class="token punctuation">,</span> <span class="token string">'iMac'</span><span class="token punctuation">,</span> <span class="token string">'iPad'</span><span class="token punctuation">,</span> <span class="token string">'iPod'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>appleCompany <span class="token operator">===</span> copyApple<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
</code></pre></div></li></ol> <h2 id="_38-string-startwith和indexof"><a href="#_38-string-startwith和indexof" class="header-anchor">#</a> 38. string.startWith和indexOf</h2> <p><strong>startWith(stringObj, str, position)</strong></p> <p>stringObj,要搜索的字符串对象，str，搜索的字符串， position，可选，从哪个位置开始搜索.返回true false</p> <p><strong>indexOf(item, startindex)</strong></p> <p>返回在数组中可以找到给定元素在指定位置开始的第一个索引，如果不存在，则返回-1</p> <h2 id="_39-字符串转数字"><a href="#_39-字符串转数字" class="header-anchor">#</a> 39. 字符串转数字</h2> <p>parseInt(string, base)</p> <h2 id="_40-let-const-var-的区别-什么是块级作用域-如何用-es5-的方法实现块级作用域-立即执行函数-es6-呢"><a href="#_40-let-const-var-的区别-什么是块级作用域-如何用-es5-的方法实现块级作用域-立即执行函数-es6-呢" class="header-anchor">#</a> 40. let const var 的区别 ，什么是块级作用域，如何用 ES5 的方法实现块级作用域（立即执行函数），ES6 呢</h2> <h3 id="_40-1-var"><a href="#_40-1-var" class="header-anchor">#</a> 40.1 var</h3> <ul><li><p>存在变量提升（即变量可以在声明之前调用，值为undefined）。</p></li> <li><p>不存在块级作用域（语句块里的变量可在外部访问）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 10</span>
</code></pre></div></li> <li><p>变量可多次声明，后面声明覆盖前面的</p></li> <li><p>函数内定义的var变量只能在函数内作用，即局部的，函数内不使用var，则为全局的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
<span class="token comment">//----------------------------</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
</code></pre></div></li></ul> <h3 id="_40-2-let和const"><a href="#_40-2-let和const" class="header-anchor">#</a> 40.2 let和const</h3> <ul><li><p>不存在变量提升，所声明的变量一定要在声明后使用</p></li> <li><p>存在块级作用域，定义的变量仅在块级作用域有效</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ReferenceError: a is not defined</span>
</code></pre></div></li> <li><p>相同作用域不能重复声明</p></li> <li><p>const声明只读变量，值不能改变（对于对象，对象的属性值可变），且必须初始化</p></li></ul> <p>区别就是：var可变量提升，let和const不可；var无块级作用域，let和const无；const变量只读，let和var可改</p> <p>注意：const变量的<strong>只读是针对基础数据类型</strong>，因为const是保证该<strong>变量所指的内存地址储存值不变</strong>，对于基础数据来讲就是其值，但对于对象来讲，不变的是指针，指针所指的堆空间里的对象值即属性是可以更改的。</p> <p>想让对象无法修改属性 =&gt; Object.freeze()进行冻结</p> <h3 id="_40-3-作用域-局部、全局、块级作用域"><a href="#_40-3-作用域-局部、全局、块级作用域" class="header-anchor">#</a> 40.3 作用域（局部、全局、块级作用域）</h3> <p>函数中打印a的值不是由写代码的位置（词法作用域）确定的，而是取决于函数执行的位置（动态作用域）。</p> <p><strong>三大原则：</strong></p> <ol><li><p>外面的访问不到里面的，函数里面的可以访问外部变量</p></li> <li><p>查找var定义变量采取就近原则</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined，查找a的时候会先在函数内查找，由于预解析的作用，此时的a是undefined,因此永远不会去查找外面的10了</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
    a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
<span class="token punctuation">}</span>
<span class="token function">aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>传参和局部变量重名，优先级等同，看顺序</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">aaa</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">aaa</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>传参，基础类型为值，引用类型为引用。但对引用类型赋值后不会影响其他。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> a<span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
c<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a:'</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1,2,3,4];</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b:'</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1,2,3,4];</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c:'</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[5, 6, 7, 8, 9];</span>
</code></pre></div><p>参数作用域：函数进行声明初始化时，参数会形成一个单独的作用域。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y <span class="token operator">=</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 2，参数作用域里面，默认值变量x指向第一个参数x，而不是全局变量x，所以输出是2。</span>

<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">y <span class="token operator">=</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1，参数作用域里面，变量x本身没有定义，所以指向外层的全局变量x。函数调用时，函数体内部的局部变量x影响不到默认值变量x。</span>

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">y <span class="token operator">=</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 若没有全局x，ReferenceError: x is not defined</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x <span class="token operator">=</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// x=x相当于let x=x，由于暂时性死区，会抛出异常：ReferenceError: x is not defined</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// 参数y这个函数中的x=1改变的是参数的x</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function-variable function">y</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment">// 3 1 2 0</span>
</code></pre></div></li> <li><p>没有var的变量直接赋值默认定义了一个全局变量，没有var变量，且赋值前打印会报错</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token comment">// 报错 e is undefined</span>
e<span class="token operator">=</span><span class="token number">555</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token comment">// e</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 msg <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123 123</span>
</code></pre></div></li></ol> <p><strong>块级作用域</strong>指在If语句，switch语句，循环语句等语句块**（{}）<strong>中</strong>定义（let const）变量**，这意味着变量<strong>不能在语句块之外被访问</strong>。</p> <p><strong>局部作用域</strong>是通过<strong>函数</strong>来定义的，在一个函数中定义的变量（局部变量）只对这个<strong>函数内部可见</strong>。程序执行完毕就会销毁。</p> <p><strong>全局作用域</strong>是指不在任何函数内定义的变量。只有浏览器关闭的时候才会销毁，比较占内存资源</p> <p><strong>静态作用域</strong>即函数定义位置就决定了作用域，若函数里找不到变量，则在它的作用域里找（函数<strong>定义所处的位置</strong>决定）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 结果是1，bar（）作用域为window</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">4</span>
        <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">return</span> fn3
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1， fn2作用域为window</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">4</span>
        <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">return</span> fn3
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2，fn2的作用域为fn1函数</span>
</code></pre></div><h3 id="_40-4-变量提升和函数提升"><a href="#_40-4-变量提升和函数提升" class="header-anchor">#</a> 40.4 变量提升和函数提升</h3> <p>变量提升是针对于var定义的。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 变量提升，定义还未赋值undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// 没有用var，报错，ReferenceError: b is not defined</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
b<span class="token operator">=</span><span class="token number">2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// 2</span>
</code></pre></div><p>函数提升有两种声明</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//函数声明式，函数提升是整个代码块（相当于申明和初始化都提升了）提升到它所在的作用域的最开始执行</span>
<span class="token keyword">function</span> <span class="token function">bar</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//函数字面量式，这种情况和变量提升是一样的</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1 ，因为函数提升（函数声明式）比变量提升（var foo和函数字面量式）更优先</span>
 
<span class="token keyword">var</span> foo<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span><span class="token string">'1'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span><span class="token string">'2'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token string">'3'</span><span class="token punctuation">;</span> <span class="token comment">// 3|3，传参为引用类型，传的是引用，该其属性，都会变</span>
  <span class="token comment">// obj = {num:'3'}; // 结果为：3|1，对obj赋值是将原本存obj的地址信息变为了新的对象</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">.</span>num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">change</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result <span class="token operator">+</span> <span class="token string">' | '</span> <span class="token operator">+</span> a<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h3 id="_40-5-var来实现let"><a href="#_40-5-var来实现let" class="header-anchor">#</a> 40.5 var来实现let</h3> <p>闭包+自执行函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 利用函数作用域</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_41-获取对象属性名"><a href="#_41-获取对象属性名" class="header-anchor">#</a> 41. 获取对象属性名</h2> <ul><li><p><strong>获取可枚举的属性</strong></p> <p>for...in...</p> <p>Object.keys()</p></li> <li><p><strong>获取可枚举和不可枚举属性(不包括symbol)</strong></p> <p>Object.getOwnPropertyNames()</p></li> <li><p><strong>查询自身属性（忽略原型上的）</strong></p> <p>obj.hasOwnProperty()  return true or false</p></li> <li><p><strong>获取对象所有属性</strong></p> <p>Reflect.ownKeys()</p></li></ul> <h2 id="_42-es6新特性"><a href="#_42-es6新特性" class="header-anchor">#</a> 42. ES6新特性</h2> <ol><li>引入let、const</li> <li>解构赋值、扩展运算符</li> <li>引入新的数据类型（symbol）、数据结构（map、set）、方法（str.padStart、arr/str.includes、Array.from、arr.find、Object.assign、Object.keys、等等）</li> <li>引入promise、generator</li> <li>引入Class语法糖</li> <li>引入块级作用域</li> <li>函数参数默认值、箭头函数、</li> <li>es6导入导出的模块化</li></ol> <h2 id="_43-class"><a href="#_43-class" class="header-anchor">#</a> 43. Class</h2> <p><strong>public</strong>：public 表明该数据成员、成员函数是对所有用户开放的，所有用户都可以直接进 行调用</p> <p><strong>private</strong>：private 表示私有，私有的意思就是除了 class 自己之外，任何人都不可以直接使 用</p> <p><code>constructor(param1, param2, ...)</code>是用于初始化实例的类主体中的一种特殊方法。 在这里可以设置字段的初始值或进行任何类型的对象设置。一个 JavaScript 类最多可以有一个构造函数。</p> <p><strong>公共字段</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    age <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Fundebug'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">//在构造函数中，this 值等于新创建的实例。用于实例化类的参数成为构造函数的参数</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Fundebug' name为公共字段</span>
user<span class="token punctuation">.</span>age<span class="token punctuation">;</span> <span class="token comment">// =&gt; 12 age为公共字段</span>
</code></pre></div><p><strong>私有字段#</strong></p> <p>隐藏对象内部数据的一种好方法是使用私有字段。这些字段<strong>只能在它们所属的类中读取和更改</strong>。类的外部世界不能直接更改私有字段。在字段名前面加上特殊的符号<code>#</code>使其成为私有的。确保在实例初始化时可以一次设置私有字段。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  #name<span class="token punctuation">;</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'Fundebug'</span><span class="token punctuation">)</span>
user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 'Fundebug'</span>

user<span class="token punctuation">.</span>#name  <span class="token comment">// 在 User 主体之外访问私有字段#name，则会抛出一个语法错误:SyntaxError: Private field '#name' must be declared in an enclosing class。</span>
</code></pre></div><p><strong>公共静态字段static</strong></p> <p>有助于定义<strong>类常量</strong>或<strong>存储特定于该类</strong>的信息。使用特殊的关键字<code>static</code>后面跟字段名。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token constant">TYPE_ADMIN</span> <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token constant">TYPE_REGULAR</span> <span class="token operator">=</span> <span class="token string">&quot;regular&quot;</span><span class="token punctuation">;</span>

    name<span class="token punctuation">;</span>
    type<span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> admin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">,</span> User<span class="token punctuation">.</span><span class="token constant">TYPE_ADMIN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
admin<span class="token punctuation">.</span>type <span class="token operator">===</span> User<span class="token punctuation">.</span><span class="token constant">TYPE_ADMIN</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
</code></pre></div><p><strong>私有静态字段static #</strong></p> <p>想隐藏静态字段的实现细节，使静态字段成为私有的，只要字段名前面加上<code>#</code>符号。<strong>只能在<code>User</code>类中访问</strong>。</p> <p>列入限制生成实例个数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> #<span class="token constant">MAX_INSTANCES</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">//设置允许的最大实例数</span>
    <span class="token keyword">static</span> #instances <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//计算实际的实例数</span>

    name<span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        User<span class="token punctuation">.</span>#instances<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//使用User.访问</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>User<span class="token punctuation">.</span>#instances <span class="token operator">&gt;</span> User<span class="token punctuation">.</span>#<span class="token constant">MAX_INSTANCES</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to create User instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws Error</span>
</code></pre></div><p><strong>实例方法</strong></p> <p>实例方法可以<strong>访问和修改实例数据</strong>。实例方法可以调用其他实例方法，也可以调用任何静态方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">nameContains</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">nameContains</span><span class="token punctuation">(</span><span class="token string">&quot;Fun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
user<span class="token punctuation">.</span><span class="token function">nameContains</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; false</span>
</code></pre></div><p><strong>私有方法</strong></p> <p>使方法私有前缀，名称以＃开头即可。私有方法<strong>不能在<code>User</code> 类主体之外调用</strong>。</p> <p><strong>静态方法</strong></p> <p>静态方法是直接附加到类的函数，它们持有与类相关的逻辑，而不是类的实例。特殊的关键字<code>static</code>。</p> <ol><li><strong>静态方法可以访问静态字段。</strong></li> <li><strong>静态方法不能访问实例字段</strong></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> #takenNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token function">isNameTaken</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> User<span class="token punctuation">.</span>#takenNames<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    name <span class="token operator">=</span> <span class="token string">&quot;无名氏&quot;</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        User<span class="token punctuation">.</span>#takenNames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

User<span class="token punctuation">.</span><span class="token function">isNameTaken</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
User<span class="token punctuation">.</span><span class="token function">isNameTaken</span><span class="token punctuation">(</span><span class="token string">&quot;Code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; false</span>
</code></pre></div><p>静态方法可以是私有的:<code>static #staticFunction() {...}</code>。同样，它们遵循私有规则:只能在类主体中调用私有静态方法。</p> <p><strong>继承</strong></p> <p>在<code>class Child extends Parent {} 表达式中，</code>Child<code>类从</code>Parent`继承构造函数，字段和方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ContentWriter</span> <span class="token keyword">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    posts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//ContentWriter继承了User的构造函数，方法getName()和字段name。同样，ContentWriter类声明了一个新的字段posts</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>super()</strong></p> <p><strong>在子类中调用父构造函数，则需要使用子构造函数中可用的<code>super()</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code>lass User <span class="token punctuation">{</span>
    name<span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ContentWriter</span> <span class="token keyword">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    posts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> posts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用super()调用父类的构造函数，</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>posts <span class="token operator">=</span> posts<span class="token punctuation">;</span> <span class="token comment">// 在使用this关键字之前，必须在子构造函数中执行super()</span>
    <span class="token punctuation">}</span>
    
     <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用super()调用父类的方法，方法重写</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;无名氏&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentWriter</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;Why I like JS&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Fundebug'</span>
writer<span class="token punctuation">.</span>posts<span class="token punctuation">;</span> <span class="token comment">// =&gt; ['Why I like JS']</span>
</code></pre></div><p>在使用<code>this</code>关键字之前，<strong>必须在子构造函数中执行<code>super()</code></strong>，以确保父构造函数初始化实例</p> <p><strong>instanceof</strong></p> <p><code>object instanceof Class</code>是确定<code>object</code> 是否为<code>Class</code>实例的运算符，如</p> <div class="language-js extra-class"><pre class="language-js"><code>user <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; false</span>
</code></pre></div><p><code>instanceof</code>是多态的:操作符可检测当前实例是否为其类的父类的实例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ContentWriter</span> <span class="token keyword">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
writer <span class="token keyword">instanceof</span> <span class="token class-name">ContentWriter</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
writer <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>

<span class="token comment">// 如果想确定实例的确切类，该怎么办?可以使用构造函数属性并直接与类进行比较</span>
writer<span class="token punctuation">.</span>constructor <span class="token operator">===</span> ContentWriter<span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
writer<span class="token punctuation">.</span>constructor <span class="token operator">===</span> User<span class="token punctuation">;</span> <span class="token comment">// =&gt; false</span>
</code></pre></div><p><strong>ES5: 类是在原型继承的基础上构建的</strong></p> <p>每个类都是一个函数，并在作为构造函数调用时创建一个实例。以下两个代码段是等价的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Fundebug'</span>
user <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">User</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;Fundebug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Fundebug'</span>
user <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
</code></pre></div><h2 id="_44-arguments"><a href="#_44-arguments" class="header-anchor">#</a> 44. arguments</h2> <p>Javascrip中每个函数都会有一个Arguments对象实例arguments，它<strong>引用着函数的实参</strong>，可以用数组下标的方式&quot;[]&quot;引用arguments的元素。本身并不能调用数组方法，它是一个另外一种对象类型，只不过属性从0开始排，依次 为0，1，2...最后还有<strong>callee和length</strong>属性。</p> <p>arguments.length为函数实参个数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            s <span class="token operator">+=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出结果：name,age</span>
</code></pre></div><p>arguments.callee引用函数自身</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> n <span class="token operator">+</span> arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//6 5 4 3 2 1</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出结果：21</span>
</code></pre></div><p><strong>如何转化成数组：</strong></p> <p><strong>Array.prototype.slice.call()</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//args可以调用数组原生的方法啦</span>
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
</code></pre></div><p><strong>Array.from()</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//args可以调用数组原生的方法啦</span>
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
</code></pre></div><p><strong>ES6展开运算符</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//args可以调用数组原生的方法啦</span>
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
</code></pre></div><p><strong>利用concat+apply</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//apply方法会把第二个参数展</span>
开
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//args可以调用数组原生的方法啦</span>
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
</code></pre></div><h2 id="_45-js判断数组中是否包含某个值"><a href="#_45-js判断数组中是否包含某个值" class="header-anchor">#</a> 45. JS判断数组中是否包含某个值</h2> <p><strong>array.indexOf</strong></p> <p>有则返回坐标，无则返回-1</p> <p><strong>array.includes(searcElement[,fromIndex])</strong></p> <p>有则返回true，无则返回false</p> <p><strong>array.find(callback[, thisArg])</strong></p> <p>返回数组中满足条件的<strong>第一个元素的值</strong>，如果没有，返回undefined</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
<span class="token keyword">return</span> item <span class="token operator">&gt;</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>array.findeIndex(callback[,thisArg])</strong></p> <p>返回数组中满足条件的<strong>第一个元素的下标</strong>，如果没有找到，返回 -1</p> <h2 id="_46-数组的扁平化"><a href="#_46-数组的扁平化" class="header-anchor">#</a> 46. 数组的扁平化</h2> <p>即提取嵌套数组元素最终合并为一个数组</p> <ol><li><p>用ES6中的flat方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> ary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
ary <span class="token operator">=</span> ary<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>replace+spilt</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> ary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>ary<span class="token punctuation">)</span><span class="token punctuation">;</span>
ary <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\[|\])</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>replace+Json.parse</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> ary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>ary<span class="token punctuation">)</span><span class="token punctuation">;</span>
str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\[|\])</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5,6</span>
str <span class="token operator">=</span> <span class="token string">'['</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">;</span> <span class="token comment">// [1,2,3,4,5,6]</span>
ary <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5,6</span>
</code></pre></div></li> <li><p>普通递归</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> item <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>reduce</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">ary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> ary<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> pre<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">flatten</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token operator">:</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> ary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>ary<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>扩展运算符</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//只要有一个元素有数组，那么循环继续</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>ary<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span>isArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
ary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>ary<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="_47-高阶函数"><a href="#_47-高阶函数" class="header-anchor">#</a> 47. 高阶函数</h2> <h3 id="_47-1-map"><a href="#_47-1-map" class="header-anchor">#</a> 47.1 map</h3> <ul><li>接受两个参数，一个是回调函数（被默认传入三个值，依次为<strong>当前元素、当前索引、整个数组</strong>），一个是回调函数的this值(可选)。</li> <li>创建一个<strong>新数组</strong>，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果，<strong>对原来的数组没有影响</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>val<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> newNums <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index<span class="token punctuation">,</span>array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> item <span class="token operator">+</span> index <span class="token operator">+</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>val<span class="token punctuation">;</span>
<span class="token comment">//对第一个元素，1 + 0 + 1 + 5 = 7</span>
<span class="token comment">//对第二个元素，2 + 1 + 2 + 5 = 10</span>
<span class="token comment">//对第三个元素，3 + 2 + 3 + 5 = 13</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newNums<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[7, 10, 13]</span>
</code></pre></div><h3 id="_47-2-reduce"><a href="#_47-2-reduce" class="header-anchor">#</a> 47.2 reduce</h3> <ul><li>接收两个参数，一个为回调函数（<strong>积累值、当前值、当前索引和整个数组</strong>），另一个为初始值。</li> <li>不传默认值会自动以第一个元素为初始值，然后从第二个元素开始依次累计</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 多个数的加和</span>
<span class="token keyword">let</span> newNums <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">preSum<span class="token punctuation">,</span>curVal<span class="token punctuation">,</span>currentIndex<span class="token punctuation">,</span>array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> preSum <span class="token operator">+</span> curVal<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newNums<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//6</span>
</code></pre></div><h3 id="_47-3-filter"><a href="#_47-3-filter" class="header-anchor">#</a> 47.3 filter</h3> <ul><li>接受一个默认参数，就是<strong>当前元素</strong>。这个作为参数的函数返回值为一个布 尔类型，决定元素是否保留。</li> <li>filter方法返回值为一个新的数组，这个数组里面包含参数里面所有被保留的项。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 保留奇数项</span>
<span class="token keyword">let</span> oddNums <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oddNums<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, 3 ]</span>
</code></pre></div><h3 id="_47-4-sort"><a href="#_47-4-sort" class="header-anchor">#</a> 47.4 sort</h3> <ul><li>用于比较的函数，它有两个默认参数，分别是代表比较的两个元素。</li> <li>当比较函数返回值大于0，则 a 在 b 的后面，即a的下标应该比b大。</li> <li>比较函数不传的时候，据字母unicode值进行升序排序</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//两个比较的元素分别为a, b</span>
nums<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> a<span class="token operator">-</span>b <span class="token comment">// &gt;0即a的下标比b大，升序</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_47-5-splice"><a href="#_47-5-splice" class="header-anchor">#</a> 47.5 splice</h3> <ul><li>从 startIndex的位置开始，删除 count 个元素，然后再插入一系列的元素</li> <li>返回值为被删除的元素数组</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//两个比较的元素分别为a, b</span>
<span class="token keyword">let</span> deteled <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token comment">// [ 1, 4, 5, 6 ]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>deteled<span class="token punctuation">)</span> <span class="token comment">// [2, 3]</span>
</code></pre></div><h2 id="_48-面向对象编程"><a href="#_48-面向对象编程" class="header-anchor">#</a> 48. 面向对象编程</h2> <p>js是伪面向对象，es5时，用function设构造函数，es6后有了class和extend。</p> <ol><li><p><strong>封装</strong></p> <p>我们平时所⽤的⽅法和类都是⼀种封装，当我们在项⽬开发中，遇到⼀段功能的代码在好多地⽅重复使⽤的时候，我们可以把他单独封装成⼀个功能的⽅法，这样在我们需要使⽤的地⽅直接调⽤就可以了。</p></li> <li><p><strong>继承</strong></p> <p>继承在我们的项⽬开发中主要使⽤为⼦类继承⽗类，下⾯是es6继承的书写⽅法</p></li> <li><p><strong>多态</strong></p> <p>多态的具体表现为⽅法重载和⽅法重写：</p> <p><strong>⽅法重载</strong>：重载是指<strong>不同的函数使⽤相同的函数名</strong>，但是函数的<strong>参数个数或类型不同</strong>。调⽤的时候根据函数的参数来区别不同的函数</p> <p><strong>⽅法重写</strong>：重写（也叫覆盖）是指在<strong>派⽣类中重新对基类中的虚函数（注意是虚函数）重新实现</strong>。即函数名和参数都⼀样，只是函数的实现体不⼀样</p></li></ol> <h2 id="_49-await请求"><a href="#_49-await请求" class="header-anchor">#</a> 49. await请求</h2> <h3 id="_49-1-多个请求"><a href="#_49-1-多个请求" class="header-anchor">#</a> 49.1 多个请求</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 修改后</span>
 <span class="token keyword">async</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
       <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachePromise<span class="token punctuation">;</span>  <span class="token comment">// 出错了</span>
       <span class="token keyword">const</span> cache2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachePromise2<span class="token punctuation">;</span>  <span class="token comment">//执行</span>
       <span class="token keyword">const</span> cache3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachePromise3<span class="token punctuation">;</span>  <span class="token comment">//执行</span>
       <span class="token keyword">const</span> cache4 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachePromise4<span class="token punctuation">;</span>  <span class="token comment">//执行</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="_49-2-并发请求"><a href="#_49-2-并发请求" class="header-anchor">#</a> 49.2 并发请求</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 写法一</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>cache<span class="token punctuation">,</span> cache2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>cachePromise<span class="token punctuation">,</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>cachePromise2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 写法二</span>
<span class="token keyword">let</span> p<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cachePromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cachePromise2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cache<span class="token operator">=</span> <span class="token keyword">await</span> p<span class="token punctuation">;</span>
<span class="token keyword">let</span> cache2<span class="token operator">=</span> <span class="token keyword">await</span> p2<span class="token punctuation">;</span>
</code></pre></div><h2 id="_50-密集型计算优化-时间分片"><a href="#_50-密集型计算优化-时间分片" class="header-anchor">#</a> 50. 密集型计算优化-时间分片</h2> <ol><li><p>webworker</p> <p>建立worker线程，将计算逻辑放在worker线程执行，与主线程的数据交换通过postMessage和onMessage进行。worker.terminate暂停停止。</p></li> <li><p>将计算函数改为generactor函数，任务分片</p></li> <li><p>将计算函数写到requestAnimationFrame</p></li></ol> <p>使用时间切片的缺点是，任务运行的总时间变长了，这是因为它每处理完一个小任务后，主线程会空闲出来，并且在下一个小任务开始处理之前有一小段延迟。 但是为了避免卡死浏览器，这种取舍是很有必要的。</p> <h2 id="_51-forof和forin"><a href="#_51-forof和forin" class="header-anchor">#</a> 51. forof和forin</h2> <h3 id="_51-1-for-in-对象属性"><a href="#_51-1-for-in-对象属性" class="header-anchor">#</a> 51.1 for.in（对象属性）</h3> <p>for...in 循环只遍历<strong>可枚举属</strong>性名,包括原型链上的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_51-2-for-of-数组值、字符串、map-set"><a href="#_51-2-for-of-数组值、字符串、map-set" class="header-anchor">#</a> 51.2 for.of（数组值、字符串、map/set）</h3> <p>for...of语句在<strong>可迭代对象</strong>（包括Array，Map，Set，String，TypedArray，arguments 对象等等）上创建一个迭代循环，调用自定义迭代钩子，并为每个不同属性的值执行语句。不支持普通对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> val <span class="token keyword">of</span> array1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_51-3-区别"><a href="#_51-3-区别" class="header-anchor">#</a> 51.3 区别</h3> <p><strong>可枚举</strong></p> <p>for...in语句以任意顺序迭代对象的可枚举属性。enumerable，默认为true。判断：<strong>obj.propertyIsEnumerable(prop)</strong>。js中基本包装类型的<strong>原型属性是不可枚举的，如Object, Array, Number</strong></p> <p>Object.keys(obj)；返回一个包括对象自身可枚举属性的健名的数组</p> <p><strong>可迭代</strong></p> <p>for...of 语句遍历可迭代对象定义要迭代的数据。</p> <p><strong>可迭代</strong>的内置类型包括 <strong>Array、String、Set 和 Map、特殊类数组对象（arguments、dom节点等）</strong>, <strong>对象不可迭代</strong>，因为它没有指定 迭代器方法。可以为其对象添加迭代方法，对象才可迭代。有迭代行为才可使用for...of。</p> <p>判断：当一个数据具备<code>Symbol.iterator</code>属性的时候，才可以用<code>for...of</code>进行迭代。比如：Array.prototype.hasOwnProperty(Symbol.iterator)</p> <h3 id="_51-4-迭代器"><a href="#_51-4-迭代器" class="header-anchor">#</a> 51.4 迭代器</h3> <p>它是一种接口，<strong>为各种不同的数据结构提供统一的访问机制</strong>。任何数据结构只要部署 <strong>Iterator 接口</strong>，<strong>就可以完成遍历操作</strong>（即依次处理该数据结构的所有成员）</p> <p>过程：</p> <p>（1）创建一个指针对象，指向当前数据结构的起始位置。</p> <p>（2）第一次调用指针对象的next方法，可以将指针指向数据结构的第一个成员。</p> <p>（3）第二次调用指针对象的next方法，指针就指向数据结构的第二个成员。</p> <p>（4）不断调用指针对象的next方法，直到它指向数据结构的结束位置。</p> <h2 id="_52-for和foreach和map"><a href="#_52-for和foreach和map" class="header-anchor">#</a> 52. for和foreach和map</h2> <p>如果只谈性能，显然是 for &gt; forEach &gt; map</p> <ul><li>for循环按顺序遍历，forEach使用iterator迭代器遍历</li> <li>对于arraylist，是顺序表，使用for循环可以顺序访问，速度较快；使用foreach会比for循环稍慢一些。
对于linkedlist，是单链表，使用for循环每次都要从第一个元素读取next域来读取，速度非常慢；使用foreach可以直接读取当前结点，数据较快；</li> <li>map会返回新数组，foreach不会</li></ul> <p>在硬件发展时代，牺牲一点性能，使用高阶函数代替for，代码可维护性更高，逻辑更清晰。</p> <ul><li>如果你需要将数组按照某种规则映射为另一个数组，就应该用 map。</li> <li>如果你需要进行简单的遍历，用 forEach 或者 for of。</li> <li>如果你需要对迭代器进行遍历，用 for of.</li> <li>如果你需要过滤出符合条件的项，用 filter.</li></ul> <p>倒序for快于正序for：for<code>（倒序）只需要计算一次起始变量</code>let i = arr.length<code>，而在正序的</code>for<code>循环中，它在每次变量增加后都会检查条件</code>i&lt;arr.length`。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_1-判断变量是数组还是对象" class="sidebar-link reco-side-_1-判断变量是数组还是对象" data-v-70334359>1. 判断变量是数组还是对象</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_1-1-类型判断" class="sidebar-link reco-side-_1-1-类型判断" data-v-70334359>1.1 类型判断</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_1-2-null和undefined和nan" class="sidebar-link reco-side-_1-2-null和undefined和nan" data-v-70334359>1.2 null和undefined和NaN</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_2-js防抖节流函数" class="sidebar-link reco-side-_2-js防抖节流函数" data-v-70334359>2. js防抖节流函数</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_3-预编译" class="sidebar-link reco-side-_3-预编译" data-v-70334359>3. 预编译</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_4-this指向" class="sidebar-link reco-side-_4-this指向" data-v-70334359>4. this指向</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_5-箭头函数的this" class="sidebar-link reco-side-_5-箭头函数的this" data-v-70334359>5. 箭头函数的this</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_6-手写call和apply" class="sidebar-link reco-side-_6-手写call和apply" data-v-70334359>6. 手写call和apply</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_6-1-call和apply作用" class="sidebar-link reco-side-_6-1-call和apply作用" data-v-70334359>6.1 call和apply作用</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_6-2-bind" class="sidebar-link reco-side-_6-2-bind" data-v-70334359>6.2 bind</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_7-事件循环机制event-loop" class="sidebar-link reco-side-_7-事件循环机制event-loop" data-v-70334359>7. 事件循环机制event-loop</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_9-深浅拷贝" class="sidebar-link reco-side-_9-深浅拷贝" data-v-70334359>9. 深浅拷贝</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_9-1-赋值和深浅拷贝的区别" class="sidebar-link reco-side-_9-1-赋值和深浅拷贝的区别" data-v-70334359>9.1 赋值和深浅拷贝的区别</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_10-优化条件语句" class="sidebar-link reco-side-_10-优化条件语句" data-v-70334359>10. 优化条件语句</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_11-js数据类型" class="sidebar-link reco-side-_11-js数据类型" data-v-70334359>11. js数据类型</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_11-1-symbol" class="sidebar-link reco-side-_11-1-symbol" data-v-70334359>11.1 Symbol</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_11-2-null" class="sidebar-link reco-side-_11-2-null" data-v-70334359>11.2 null</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_11-3-bigint" class="sidebar-link reco-side-_11-3-bigint" data-v-70334359>11.3 Bigint</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_11-4-map" class="sidebar-link reco-side-_11-4-map" data-v-70334359>11.4 Map</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_11-5-set" class="sidebar-link reco-side-_11-5-set" data-v-70334359>11.5 Set</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_12-数组去重" class="sidebar-link reco-side-_12-数组去重" data-v-70334359>12. 数组去重</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_12-1-set去重" class="sidebar-link reco-side-_12-1-set去重" data-v-70334359>12.1 Set去重</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_12-2-两次循环" class="sidebar-link reco-side-_12-2-两次循环" data-v-70334359>12.2 两次循环</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_12-3-indexof、includes、filter实现" class="sidebar-link reco-side-_12-3-indexof、includes、filter实现" data-v-70334359>12.3 indexOf、includes、filter实现</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_13-发布-订阅模式和观察者模式" class="sidebar-link reco-side-_13-发布-订阅模式和观察者模式" data-v-70334359>13. 发布-订阅模式和观察者模式</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_13-1-发布订阅模式" class="sidebar-link reco-side-_13-1-发布订阅模式" data-v-70334359>13.1 发布订阅模式</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_13-2-观察者模式" class="sidebar-link reco-side-_13-2-观察者模式" data-v-70334359>13.2 观察者模式</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_14-闭包" class="sidebar-link reco-side-_14-闭包" data-v-70334359>14. 闭包</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_15-new" class="sidebar-link reco-side-_15-new" data-v-70334359>15. new</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_16-事件委托" class="sidebar-link reco-side-_16-事件委托" data-v-70334359>16. 事件委托</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_17-封装dom库" class="sidebar-link reco-side-_17-封装dom库" data-v-70334359>17. 封装dom库</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_18-promise-async-await-generator" class="sidebar-link reco-side-_18-promise-async-await-generator" data-v-70334359>18. promise+async/await+generator</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_18-1-promise" class="sidebar-link reco-side-_18-1-promise" data-v-70334359>18.1 promise</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_18-2-async-await" class="sidebar-link reco-side-_18-2-async-await" data-v-70334359>18.2 async/await</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_18-3-generator" class="sidebar-link reco-side-_18-3-generator" data-v-70334359>18.3 generator</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_19-原型" class="sidebar-link reco-side-_19-原型" data-v-70334359>19. 原型</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_20-继承" class="sidebar-link reco-side-_20-继承" data-v-70334359>20. 继承</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_21-事件流" class="sidebar-link reco-side-_21-事件流" data-v-70334359>21. 事件流</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_22-图片加载" class="sidebar-link reco-side-_22-图片加载" data-v-70334359>22. 图片加载</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_23-鼠标事件" class="sidebar-link reco-side-_23-鼠标事件" data-v-70334359>23. 鼠标事件</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_24-鼠标拖拉功能" class="sidebar-link reco-side-_24-鼠标拖拉功能" data-v-70334359>24. 鼠标拖拉功能</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_25-js的异步加载" class="sidebar-link reco-side-_25-js的异步加载" data-v-70334359>25. js的异步加载</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_27-eval" class="sidebar-link reco-side-_27-eval" data-v-70334359>27. eval()</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_28-前端模块化commonjs、amd、cmd和es6模块系统" class="sidebar-link reco-side-_28-前端模块化commonjs、amd、cmd和es6模块系统" data-v-70334359>28. 前端模块化commonJS、AMD、CMD和ES6模块系统</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_29-和-、以及object-is的区别" class="sidebar-link reco-side-_29-和-、以及object-is的区别" data-v-70334359>29. ==和===、以及Object.is的区别</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_30-settimeout、setinterval-和-requestanimationframe-之间的区别" class="sidebar-link reco-side-_30-settimeout、setinterval-和-requestanimationframe-之间的区别" data-v-70334359>30. setTimeout、setInterval 和 requestAnimationFrame 之间的区别</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_31-性能优化" class="sidebar-link reco-side-_31-性能优化" data-v-70334359>31. 性能优化</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_32-js语言特性" class="sidebar-link reco-side-_32-js语言特性" data-v-70334359>32. js语言特性</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_33-暂时性死区" class="sidebar-link reco-side-_33-暂时性死区" data-v-70334359>33. 暂时性死区</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_34-实现深拷贝" class="sidebar-link reco-side-_34-实现深拷贝" data-v-70334359>34. 实现深拷贝</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_35-按需加载" class="sidebar-link reco-side-_35-按需加载" data-v-70334359>35. 按需加载</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_36-虚拟dom" class="sidebar-link reco-side-_36-虚拟dom" data-v-70334359>36. 虚拟dom</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_37-单例模式" class="sidebar-link reco-side-_37-单例模式" data-v-70334359>37. 单例模式</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_38-string-startwith和indexof" class="sidebar-link reco-side-_38-string-startwith和indexof" data-v-70334359>38. string.startWith和indexOf</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_39-字符串转数字" class="sidebar-link reco-side-_39-字符串转数字" data-v-70334359>39. 字符串转数字</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_40-let-const-var-的区别-什么是块级作用域-如何用-es5-的方法实现块级作用域-立即执行函数-es6-呢" class="sidebar-link reco-side-_40-let-const-var-的区别-什么是块级作用域-如何用-es5-的方法实现块级作用域-立即执行函数-es6-呢" data-v-70334359>40. let const var 的区别 ，什么是块级作用域，如何用 ES5 的方法实现块级作用域（立即执行函数），ES6 呢</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_40-1-var" class="sidebar-link reco-side-_40-1-var" data-v-70334359>40.1 var</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_40-2-let和const" class="sidebar-link reco-side-_40-2-let和const" data-v-70334359>40.2 let和const</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_40-3-作用域-局部、全局、块级作用域" class="sidebar-link reco-side-_40-3-作用域-局部、全局、块级作用域" data-v-70334359>40.3 作用域（局部、全局、块级作用域）</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_40-4-变量提升和函数提升" class="sidebar-link reco-side-_40-4-变量提升和函数提升" data-v-70334359>40.4 变量提升和函数提升</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_40-5-var来实现let" class="sidebar-link reco-side-_40-5-var来实现let" data-v-70334359>40.5 var来实现let</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_41-获取对象属性名" class="sidebar-link reco-side-_41-获取对象属性名" data-v-70334359>41. 获取对象属性名</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_42-es6新特性" class="sidebar-link reco-side-_42-es6新特性" data-v-70334359>42. ES6新特性</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_43-class" class="sidebar-link reco-side-_43-class" data-v-70334359>43. Class</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_44-arguments" class="sidebar-link reco-side-_44-arguments" data-v-70334359>44. arguments</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_45-js判断数组中是否包含某个值" class="sidebar-link reco-side-_45-js判断数组中是否包含某个值" data-v-70334359>45. JS判断数组中是否包含某个值</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_46-数组的扁平化" class="sidebar-link reco-side-_46-数组的扁平化" data-v-70334359>46. 数组的扁平化</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_47-高阶函数" class="sidebar-link reco-side-_47-高阶函数" data-v-70334359>47. 高阶函数</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_47-1-map" class="sidebar-link reco-side-_47-1-map" data-v-70334359>47.1 map</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_47-2-reduce" class="sidebar-link reco-side-_47-2-reduce" data-v-70334359>47.2 reduce</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_47-3-filter" class="sidebar-link reco-side-_47-3-filter" data-v-70334359>47.3 filter</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_47-4-sort" class="sidebar-link reco-side-_47-4-sort" data-v-70334359>47.4 sort</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_47-5-splice" class="sidebar-link reco-side-_47-5-splice" data-v-70334359>47.5 splice</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_48-面向对象编程" class="sidebar-link reco-side-_48-面向对象编程" data-v-70334359>48. 面向对象编程</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_49-await请求" class="sidebar-link reco-side-_49-await请求" data-v-70334359>49. await请求</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_49-1-多个请求" class="sidebar-link reco-side-_49-1-多个请求" data-v-70334359>49.1 多个请求</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_49-2-并发请求" class="sidebar-link reco-side-_49-2-并发请求" data-v-70334359>49.2 并发请求</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_50-密集型计算优化-时间分片" class="sidebar-link reco-side-_50-密集型计算优化-时间分片" data-v-70334359>50. 密集型计算优化-时间分片</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_51-forof和forin" class="sidebar-link reco-side-_51-forof和forin" data-v-70334359>51. forof和forin</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_51-1-for-in-对象属性" class="sidebar-link reco-side-_51-1-for-in-对象属性" data-v-70334359>51.1 for.in（对象属性）</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_51-2-for-of-数组值、字符串、map-set" class="sidebar-link reco-side-_51-2-for-of-数组值、字符串、map-set" data-v-70334359>51.2 for.of（数组值、字符串、map/set）</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_51-3-区别" class="sidebar-link reco-side-_51-3-区别" data-v-70334359>51.3 区别</a></li><li class="level-3" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_51-4-迭代器" class="sidebar-link reco-side-_51-4-迭代器" data-v-70334359>51.4 迭代器</a></li><li class="level-2" data-v-70334359><a href="/blog/interview/interviewBase/InterviewJS.html#_52-for和foreach和map" class="sidebar-link reco-side-_52-for和foreach和map" data-v-70334359>52. for和foreach和map</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/blog/assets/js/app.b9a39c6d.js" defer></script><script src="/blog/assets/js/3.9920081a.js" defer></script><script src="/blog/assets/js/1.a52b134f.js" defer></script><script src="/blog/assets/js/45.d326a0e3.js" defer></script>
  </body>
</html>
